---
title: Configure App in Microsoft Entra ID
description: Learn to configure your bot or message extension app with Microsoft Entra ID for enabling SSO, messaging endpoint, and OAuth connection.
ms.topic: how-to
ms.localizationpriority: high
ms.date: 03/11/2025
ms.owner: ryanbliss
---
# Configure your app in Microsoft Entra ID

Microsoft Entra ID provides app users access to your bot or message extension app. The app user who signs in to Microsoft Teams gains access to your app.

<a name='sso-configuration-in-azure-ad-portal'></a>

## SSO configuration in Microsoft Entra admin center

Bot and message extension apps use Bot Framework to communicate with app users and implement authentication.

To configure single sign-on (SSO) for your bot or message extension app, developers must:

* Configure bot resource in Microsoft Entra ID
* Configure app in Microsoft Entra ID

> [!NOTE]
> Ensure that a Microsoft Entra app and a bot resource have been created.
>
> * For more information about creating an app in Microsoft Entra ID, see [register a new app in Microsoft Entra ID](../../../tabs/how-to/authentication/tab-sso-register-aad.md#to-register-a-new-app-in-azure-ad).
> * For more information about creating and configuring your bot resource in Microsoft Entra ID, see [create Teams conversation bot](../conversations/channel-and-group-conversations.md).

Developers can configure the bot resource and app in Microsoft Entra ID for your bot or message extension app in either of these two ways:

* **Configure SSO using bot resource and configure Microsoft Entra app**: Begin by configuring SSO for the bot resource and then enable SSO for the Microsoft Entra app. Developers configure:
  * For bot resource: Messaging endpoint and OAuth connection.
  
    > [!NOTE]
    > When creating the bot resource in Microsoft Entra ID, select the option for creating a new app ID, or use an existing app ID if the app has already been registered in Microsoft Entra ID.

  * For Microsoft Entra app: App ID URI, scope and permissions, trusted client IDs, access token version, client secret, and redirect URL.

* **Configure SSO using Microsoft Entra app and then configuring bot resource**: Start by configuring the Microsoft Entra app, and then use the app ID in the bot resource when enabling SSO. Developers configure:
  * For Microsoft Entra app: App ID URI, access token version, trusted client IDs, client secret, and redirect URL.
  * For bot resource: Messaging endpoint and OAuth connection.
  
    > [!NOTE]
    > Configure the bot resource using the app ID generated by Microsoft Entra ID during the app registration.

<a name='enable-sso-in-azure-ad'></a>

## Enable SSO in Microsoft Entra ID

This tutorial guides developers through configuring:

* Application ID
* Bot ID
* Access token
  * Application ID URI
  * Scope, permissions, and authorized client IDs
  * Client secret
  * Redirect URL
* Messaging endpoint and OAuth connection

Select one of the following two methods to configure SSO for the bot resource:

# [Use bot resource and configure Microsoft Entra app](#tab/botid)

To enable SSO for your app in Microsoft Entra ID:

* **[Configure messaging endpoint](#configure-messaging-endpoint)**
* **[Configure SSO for Microsoft Entra app](#configure-sso-for-azure-ad-app)**:
  * [Configure access token version](#configure-access-token-version)
  * [Configure scope for the access token](#configure-scope-for-the-access-token)
  * [Create client secret](#create-client-secret)
  * [Configure redirect URL](#configure-redirect-url)
* **[Configure OAuth connection](#configure-oauth-connection)**

> [!IMPORTANT]
> When creating the bot resource, ensure the option to create a new app ID is selected. An existing app ID can be used if an app is already registered in the Microsoft Entra admin center.

## Configure messaging endpoint

The messaging endpoint receives messages for your bot and enables communication with the bot.

### To configure messaging endpoint for your bot resource

1. Open the [Azure portal](https://ms.portal.azure.com/) in a web browser.
   The Microsoft Azure Bot page opens.

1. Enter the name of the bot resource in the **Search** box, then press **Enter** to open it.

1. Select **Settings** > **Configuration**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-app-menu.png" alt-text="Screenshot shows the bot Configuration menu." :::

    The **Configuration** page appears.

1. Enter the messaging endpoint URL where the bot receives app users' messages.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/message-endpoint.png" alt-text="Screenshot shows the Messaging endpoint option to add the URL where the bot interacts with the user." :::

1. Select **Apply**.

    The messaging endpoint is configured.

Developers complete the messaging endpoint configuration for the bot resource. Next, enable SSO for the Microsoft Entra app.

<a name='configure-sso-for-azure-ad-app'></a>

> [!div class="nextstepaction"]
> [I ran into an issue](https://github.com/MicrosoftDocs/msteams-docs/issues/new?template=Doc-Feedback.yaml&title=%5BI+ran+into+an+issue%5D+To+configure+messaging+endpoint+for+your+bot+resource&&author=%40surbhigupta&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fmicrosoftteams%2Fplatform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad%3Ftabs%3Dbotid%23to-configure-messaging-endpoint-for-your-bot-resource&contentSourceUrl=https%3A%2F%2Fgithub.com%2FMicrosoftDocs%2Fmsteams-docs%2Fblob%2Fmain%2Fmsteams-platform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad.md&documentVersionIndependentId=ac68d7e8-2a35-5208-8724-68bd2fdd79b6&platformId=cdaccc16-060c-8eb1-2cee-c1f6a26e285c&metadata=*%2BID%253A%2Be473e1f3-69f5-bcfa-bcab-54b098b59c80%2B%250A*%2BService%253A%2B%2A%2Amsteams%2A%2A)

## Configure SSO for Microsoft Entra app

Developers must configure permissions and scopes, authorize client applications, update the app manifest, and create a client secret for the Microsoft Entra app. These configurations enable SSO for the bot app.

### Configure access token version

Developers define the access token version for the app in the Microsoft Entra app manifest.

#### To define the access token version

1. Select **Manage** > **Manifest** from the left pane.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/azure-portal-manifest.png" alt-text="Screenshot shows the Microsoft Entra admin center Manifest." :::

    The Microsoft Entra app manifest appears.

1. Set the `requestedAccessTokenVersion` property to **2**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/azure-manifest-value.png" alt-text="Screenshot shows the Value for access token version." lightbox="../../../assets/images/authentication/teams-sso-bots/azure-manifest-value.png" :::

1. Select **Save**.

    A message confirms that the app manifest updates successfully.

Developers update the access token version. Next, configure the scope of the access token.

### Configure scope for the access token

Developers configure scope (permission) options for sending an access token to the Teams client and authorizing trusted client applications for SSO.

Developers need to complete:

* [To configure application ID URI](#to-configure-application-id-uri): Expose a web API and configure the application ID URI.
* [To configure API scope](#to-configure-api-scope): Define the API scope and designate users who can consent. Administrators can limit consent for higher-privileged permissions.
* [To configure authorized client application](#to-configure-authorized-client-application): Create authorized client IDs for applications that Microsoft Teams pre-authorizes for accessing the configured app scopes.

#### To configure application ID URI

1. Open the [Azure portal](https://ms.portal.azure.com/) in a web browser.

   The Microsoft Azure Bot page opens.

1. Enter the name of the bot resource in the **Search** box, then press **Enter** to open it.

1. Select **Settings** > **Configuration**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-app-menu.png" alt-text="Screenshot shows the bot Configuration menu under Settings." :::

    The **Configuration** page appears.

1. Select **Manage**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-config-manage.png" alt-text="Screenshot shows the Bot resource configuration." :::

    The Microsoft Entra app page appears.

    The new app ID (client ID) for the app displays on this page. Note and save this app ID for updating the app manifest later. If an existing app ID was used when creating the bot resource, that app ID displays.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/aad-app-regd.png" alt-text="Screenshot shows the Bot app page with Application client ID highlighted." :::

1. Select **Manage** > **Expose an API** from the left pane.

    The **Expose an API** page appears.

1. Select **Add** to generate the application ID URI.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/expose-an-api.png" alt-text="Screenshot shows the Set option of Application ID URI." :::

    The section for setting the application ID URI appears.

1. Enter the application ID URI using the specified format.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/set-app-id-uri.png" alt-text="Screenshot shows the Application ID URI added." :::

    * The **Application ID URI** is prefilled with the app ID (GUID) in the format api://{AppID}.

    > [!IMPORTANT]
    >
    > * Developers must avoid including sensitive information because the application ID URI appears in authentication logs.
    >
    > * For a standalone bot, enter the application ID URI as api://botid-{YourBotId}, where {YourBotId} is the Microsoft Entra application ID.
    > * For an app with multiple capabilities (bot, messaging extension, and tab), enter the application ID URI as api://fully-qualified-domain-name.com/botid-{YourClientId}, where {YourClientId} is the bot app ID.
    >
    > * Use lowercase letters for the domain name.
    >
    >   For example, to create an app service with the resource name demoapplication:
    >
    >   | If base resource name used is | URL will be... | Format is supported on... |
    >   | --- | --- | --- |
    >   | demoapplication | https://demoapplication.example.net | All platforms. |
    >   | DemoApplication | https://DemoApplication.example.net | Desktop, web, and iOS only (not supported in Android). |
    >
    >    Use the lowercase option demoapplication as the base resource name.

1. Select **Save**.

    A message confirms that the application ID URI updated successfully.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/app-id-uri-msg.png" alt-text="Screenshot shows the Application ID URI updated message." :::

    The application ID URI displays on the page.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/app-id-uri-added.png" alt-text="Screenshot shows the updated Application ID URI." :::

1. Note and save the application ID URI for updating the app manifest later.

The application ID URI is configured. Developers now define the scope and permissions for the app.

> [!div class="nextstepaction"]
> [I ran into an issue](https://github.com/MicrosoftDocs/msteams-docs/issues/new?template=Doc-Feedback.yaml&title=%5BI+ran+into+an+issue%5D+To+configure+application+ID+URI&&author=%40surbhigupta&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fmicrosoftteams%2Fplatform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad%3Ftabs%3Dbotid%23to-configure-application-id-uri&contentSourceUrl=https%3A%2F%2Fgithub.com%2FMicrosoftDocs%2Fmsteams-docs%2Fblob%2Fmain%2Fmsteams-platform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad.md&documentVersionIndependentId=ac68d7e8-2a35-5208-8724-68bd2fdd79b6&platformId=cdaccc16-060c-8eb1-2cee-c1f6a26e285c&metadata=*%2BID%253A%2Be473e1f3-69f5-bcfa-bcab-54b098b59c80%2B%250A*%2BService%253A%2B%2A%2Amsteams%2A%2A)

#### To configure API scope

1. Select **+ Add a scope** in the **Scopes defined by this API** section.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/select-scope.png" alt-text="Screenshot shows the Add a scope option highlighted." :::

    The **Add a scope** page appears.

1. Enter the details for the scope:

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/add-scope.png" alt-text="Screenshot shows how to add scope details in Azure." :::

    1. Enter the scope name.
    2. Select the user who can provide consent for this scope. The default option is **Admins only**.
    3. Enter the **Admin consent display name**.
    4. Provide a description for admin consent.
    5. Enter the **User consent display name**.
    6. Provide a description for user consent.
    7. Select the **Enabled** option for state.
    8. Select **Add scope**.

        > [!NOTE]
        > For this tutorial, developers can use openid profile User.Read User.ReadBasic.All as the scope. This scope works with the [Code sample](bot-sso-code.md#code-sample). Developers may add additional Graph scopes and permissions. For more information, see [Extend your app with Microsoft Graph permissions and scopes](bot-sso-graph-api.md).

    A message confirms that the scope was added.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/scope-added-msg.png" alt-text="Screenshot shows the Scope added message." :::

    > [!NOTE]
    > The newly defined scope appears on the page. Note and save the scope for updating the OAuth connection later.

The scope and permissions are configured. Next, configure the authorized client applications for the Microsoft Entra app.

> [!div class="nextstepaction"]
> [I ran into an issue](https://github.com/MicrosoftDocs/msteams-docs/issues/new?template=Doc-Feedback.yaml&title=%5BI+ran+into+an+issue%5D+To+configure+API+scope&&author=%40surbhigupta&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fmicrosoftteams%2Fplatform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad%3Ftabs%3Dbotid%23to-configure-api-scope&contentSourceUrl=https%3A%2F%2Fgithub.com%2FMicrosoftDocs%2Fmsteams-docs%2Fblob%2Fmain%2Fmsteams-platform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad.md&documentVersionIndependentId=ac68d7e8-2a35-5208-8724-68bd2fdd79b6&platformId=cdaccc16-060c-8eb1-2cee-c1f6a26e285c&metadata=*%2BID%253A%2Be473e1f3-69f5-bcfa-bcab-54b098b59c80%2B%250A*%2BService%253A%2B%2A%2Amsteams%2A%2A)

#### To configure authorized client application

1. Navigate to the **Expose an API** page to the **Authorized client application** section and select **+ Add a client application**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/auth-client-apps.png" alt-text="Screenshot shows the Add a client application option highlighted under Authorized client applications." :::

    The **Add a client application** page appears.

1. Enter the appropriate Microsoft 365 client ID for the applications to authorize for the app’s web application.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/add-client-app.png" alt-text="Screenshot shows the Client ID added." :::

    > [!NOTE]
    >
    > * The Microsoft 365 client IDs for mobile, desktop, and web applications for Microsoft Teams, Microsoft 365 app, and Outlook are the actual IDs to add.
    > * For an app with a tab app, select either web or SPA, as mobile or desktop client applications are not allowed in Microsoft Teams.
    > * Although it is recommended to use the same App ID, developers can use a different App Registration ID in the webApplicationInfo section of the Microsoft Teams app manifest that is not the same as the Azure bot App ID. This configuration is valid and supported.
    >   * The botId in the bots section refers to the Azure Bot registration used for messaging and interaction.
    >   * The webApplicationInfo.id refers to the Microsoft Entra App Registration used for authentication such as SSO, token acquisition, and Graph API access.

1. Select one of the following client IDs:

   | Use client ID | For authorizing... |
   | --- | --- |
   | 1fec8e78-bce4-4aaf-ab1b-5451cc387264 | Microsoft Teams mobile or desktop application |
   | 5e3ce6c0-2b1f-4285-8d4b-75ee78787346 | Microsoft Teams web application |
   | 4765445b-32c6-49b0-83e6-1d93765276ca | Microsoft 365 web application |
   | 0ec893e0-5785-4de6-99da-4ed124e5296c | Microsoft 365 desktop application |
   | d3590ed6-52b3-4102-aeff-aad2292ab01c | Microsoft 365 mobile application </br> Outlook desktop application |
   | bc59ab01-8403-45c6-8796-ac3ef710b3e3 | Outlook web application |
   | 27922004-5251-4030-b22d-91ecd9a37ea4 | Outlook mobile application |
   | c0ab8ce9-e9a0-42e7-b064-33d422df41f1 | Microsoft Edge |

1. Select the application ID URI created for the app in **Authorized scopes** to add the scope to the exposed web API.

1. Select **Add application**.

    A message confirms that the authorized client app was added.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/update-app-auth-msg.png" alt-text="Screenshot shows the Client ID added message." :::

    The authorized app's client ID appears on the page.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/client-app-added.png" alt-text="Screenshot shows the newly added Client ID under Authorized client applications screen." :::

    > [!NOTE]
    > Developers can authorize more than one client application. Repeat this procedure to add additional authorized client applications.

Developers successfully configure the app scope, permissions, and client applications. Note and save the application ID URI. Next, create a client secret for the app.

> [!div class="nextstepaction"]
> [I ran into an issue](https://github.com/MicrosoftDocs/msteams-docs/issues/new?template=Doc-Feedback.yaml&title=%5BI+ran+into+an+issue%5D+To+define+the+access+token+version&&author=%40surbhigupta&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fmicrosoftteams%2Fplatform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad%3Ftabs%3Dbotid%23to-define-the-access-token-version&contentSourceUrl=https%3A%2F%2Fgithub.com%2FMicrosoftDocs%2Fmsteams-docs%2Fblob%2Fmain%2Fmsteams-platform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad.md&documentVersionIndependentId=ac68d7e8-2a35-5208-8724-68bd2fdd79b6&platformId=cdaccc16-060c-8eb1-2cee-c1f6a26e285c&metadata=*%2BID%253A%2Be473e1f3-69f5-bcfa-bcab-54b098b59c80%2B%250A*%2BService%253A%2B%2A%2Amsteams%2A%2A)

### Create client secret

A client secret serves as a string that verifies the app's identity when requesting a token.

#### To create a client secret for your app

1. Select **Manage** > **Certificates & secrets**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/client-secret-menu.png" alt-text="Screenshot shows the Certificates and secrets menu option." :::

    The **Certificates & secrets** page appears.

1. Select **+ New client secret**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/client-secret.png" alt-text="Screenshot shows the New client secret option highlighted to add a new client secret." :::

    The **Add a client secret** page appears.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/add-client-secret.png" alt-text="Screenshot shows the Add a client secret page to provide the required details." :::

    1. Enter the description.
    1. Select the duration of validity for the secret.

1. Select **Add**.

   A message confirms that the client secret was updated, and the client secret appears on the page.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/client-secret-added.png" alt-text="Screenshot shows the Client secret added message." :::

1. Select the copy button next to the **Value** of the client secret.
1. Save the copied value for updating code later.

   > [!IMPORTANT]
   > Developers must copy the client secret value immediately after creation as it appears only once and cannot be retrieved later.

Developers configure the client secret. Next, configure the redirect URL.

> [!div class="nextstepaction"]
> [I ran into an issue](https://github.com/MicrosoftDocs/msteams-docs/issues/new?template=Doc-Feedback.yaml&title=%5BI+ran+into+an+issue%5D+To+create+a+client+secret+for+your+app&&author=%40surbhigupta&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fmicrosoftteams%2Fplatform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad%3Ftabs%3Dbotid%23to-create-a-client-secret-for-your-app&contentSourceUrl=https%3A%2F%2Fgithub.com%2FMicrosoftDocs%2Fmsteams-docs%2Fblob%2Fmain%2Fmsteams-platform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad.md&documentVersionIndependentId=ac68d7e8-2a35-5208-8724-68bd2fdd79b6&platformId=cdaccc16-060c-8eb1-2cee-c1f6a26e285c&metadata=*%2BID%253A%2Be473e1f3-69f5-bcfa-bcab-54b098b59c80%2B%250A*%2BService%253A%2B%2A%2Amsteams%2A%2A)

### Configure redirect URL

Authentication configuration depends on the target platform or device. Developers may need to configure redirect URIs, authentication settings, or platform-specific details.

> [!NOTE]
>
> * If the bot app has not received IT admin consent, app users must provide consent when using the app on other platforms for the first time.
> * Implicit grant is unnecessary when SSO is enabled on a bot app.

Developers can configure authentication for multiple platforms if each URL is unique.

#### To configure redirect URL

1. Open the registered app in the [Azure portal](https://ms.portal.azure.com/).

1. Select **Manage** > **Authentication** from the left pane.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/azure-portal-platform.png" alt-text="Screenshot shows the Authentication option under Manage." :::

    The **Platform configurations** page appears.

1. Select **+ Add a platform**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/add-platform.png" alt-text="Screenshot shows the Add a platform option under Authentication." :::

    The **Configure platforms** page appears.

1. Select the desired platform type (Web or SPA) for configuration.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/configure-platform.png" alt-text="Screenshot shows the selection of web platform." :::

    The **Configure Web** page appears.

    > [!NOTE]
    > Configuration details vary based on the selected platform.

1. Enter the platform configuration details.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/config-web-platform.png" alt-text="Screenshot shows the Configure Web page to provide inputs." :::

    1. Enter a unique redirect URI.
        > [!NOTE]
        >
        > * The URL in **Redirect URIs** is an example.
        > * Developers can customize the OAuth redirect URL for the bot and identity provider based on data residency requirements, whether the bot is in the public cloud, Microsoft Azure Government cloud, or Microsoft Azure operated by 21Vianet. For details, see [OAuth URL support in Azure AI Bot Service](/azure/bot-service/ref-oauth-redirect-urls?view=azure-bot-service-4.0&preserve-view=true).
    1. Enter the front-channel logout URL.
    1. Select the tokens that Microsoft Entra ID sends for the app.

1. Select **Configure**.

    The platform configuration displays on the **Platform configurations** page.

Microsoft Entra app configuration is complete. Next, configure the OAuth connection in the bot resource to enable SSO.

> [!div class="nextstepaction"]
> [I ran into an issue](https://github.com/MicrosoftDocs/msteams-docs/issues/new?template=Doc-Feedback.yaml&title=%5BI+ran+into+an+issue%5D+To+configure+redirect+URL&&author=%40surbhigupta&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fmicrosoftteams%2Fplatform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad%3Ftabs%3Dbotid%23to-configure-redirect-url&contentSourceUrl=https%3A%2F%2Fgithub.com%2FMicrosoftDocs%2Fmsteams-docs%2Fblob%2Fmain%2Fmsteams-platform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad.md&documentVersionIndependentId=ac68d7e8-2a35-5208-8724-68bd2fdd79b6&platformId=cdaccc16-060c-8eb1-2cee-c1f6a26e285c&metadata=*%2BID%253A%2Be473e1f3-69f5-bcfa-bcab-54b098b59c80%2B%250A*%2BService%253A%2B%2A%2Amsteams%2A%2A)

## Configure OAuth connection

To support SSO on the bot, developers update the OAuth connection settings. This process associates the bot with details from the Microsoft Entra app:

* Microsoft Entra app ID (client ID)
* Tenant ID
* Scope and permissions

With the app (client) ID and client secret provided, the Bot Framework Token Store exchanges the token for a Graph token with defined permissions.

### To update OAuth connection

1. Open the [Azure portal](https://ms.portal.azure.com/) in a web browser.
   The Microsoft Azure Bot page opens.

1. Enter the name of the Microsoft Entra app in the **Search** box and open the app.

1. Select **Settings** > **Configuration**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-configuration.png" alt-text="Screenshot shows the configure OAUth settings for your bot app." :::

    The **Configuration** page appears.

1. Navigate through the **Configuration** page and select **Add OAuth Connection Settings**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-oauth-connection.png" alt-text="Screenshot shows the Add OAuth Connection Settings option highlighted." :::

    The **New Connection Setting** page appears.

1. Enter the OAuth configuration settings for the Azure bot.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/new-config-setting.png" alt-text="Screenshot shows the New Connection Setting to provide the details." :::

    1. Enter a name for the connection setting.
    1. Select the service provider.

        The remaining configuration fields appear.

        :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/new-config-setting-b.png" alt-text="Screenshot shows the additional fields for New Connection Setting." :::

    1. Enter the client ID generated when creating the bot app.
    1. Enter the client secret created for the bot.
    1. Enter the application ID URI of the bot in the **Token Exchange URL**.
    1. Enter the tenant ID.
    1. Enter the scope defined when configuring permissions.

        > [!NOTE]
        > Developers can use openid profile User.Read User.ReadBasic.All as the scope for this tutorial. This scope works with the [Code sample](bot-sso-code.md#code-sample).

1. Select **Save**.
1. Select **Apply**.

After configuring the OAuth connection, developers can select **Test connection** to confirm that the connection is successful.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/test-oauth.png" alt-text="Screenshot shows the Test OAuth connection for your bot resource option." :::

If the connection fails, Microsoft Entra ID displays an error. Developers should verify all configurations and test again.

Congratulations! Developers have completed the following app configurations in Microsoft Entra ID required to enable SSO for the bot app:

* Application ID
* Bot ID
* Access token
  * Application ID URI
  * Scope, permissions, and authorized client IDs
  * Client secret
  * Redirect URL
* Messaging endpoint and OAuth connection

> [!div class="nextstepaction"]
> [I ran into an issue](https://github.com/MicrosoftDocs/msteams-docs/issues/new?template=Doc-Feedback.yaml&title=%5BI+ran+into+an+issue%5D+To+update+OAuth+connection&&author=%40surbhigupta&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fmicrosoftteams%2Fplatform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad%3Ftabs%3Dbotid%23to-update-oauth-connection&contentSourceUrl=https%3A%2F%2Fgithub.com%2FMicrosoftDocs%2Fmsteams-docs%2Fblob%2Fmain%2Fmsteams-platform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad.md&documentVersionIndependentId=ac68d7e8-2a35-5208-8724-68bd2fdd79b6&platformId=cdaccc16-060c-8eb1-2cee-c1f6a26e285c&metadata=*%2BID%253A%2Be473e1f3-69f5-bcfa-bcab-54b098b59c80%2B%250A*%2BService%253A%2B%2A%2Amsteams%2A%2A)

# [Use Microsoft Entra app and then configure bot resource](#tab/windows)

To create and configure your app for enabling SSO in Microsoft Entra ID, developers follow these steps:

* [**Configure your Microsoft Entra app for SSO**](#configure-your-azure-ad-app-for-sso)
  * [Configure the access token version](#configure-the-access-token-version)
  * [Configure scope for access token](#configure-scope-for-access-token)
  * [Create client secret for your app](#create-client-secret-for-your-app)
  * [Configure redirect URL for your app](#configure-redirect-url-for-your-app)
* [**Configure bot resource in Microsoft Entra ID**](#configure-bot-resource-in-azure-ad)
  * [Configure messaging endpoint for your bot resource](#configure-messaging-endpoint-for-your-bot-resource)
  * [Configure OAuth connection for your bot resource](#configure-oauth-connection-for-your-bot-resource)

<a name='configure-your-azure-ad-app-for-sso'></a>

## Configure your Microsoft Entra app for SSO

Developers must configure permissions and scopes, authorize client applications, update the app manifest, and create a client secret for the Microsoft Entra app. These configurations enable SSO for the bot app.

> [!IMPORTANT]
> Ensure that the app is [registered](../../../tabs/how-to/authentication/tab-sso-register-aad.md#to-register-a-new-app-in-azure-ad) in Microsoft Entra ID. At registration, Microsoft Entra ID generates a new app ID; note this ID for later updates in the app manifest.

### Configure the access token version

Developers define the access token version in the Microsoft Entra app manifest.

#### To define access token version

1. Select **Manage** > **Manifest** from the left pane.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/azure-portal-manifest.png" alt-text="Screenshot shows the Microsoft Entra admin center Manifest." :::

    The Microsoft Entra app manifest appears.

1. Set the `requestedAccessTokenVersion` property to **2**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/azure-manifest-value.png" alt-text="Screenshot shows the Value for access token version." lightbox="../../../assets/images/authentication/teams-sso-bots/azure-manifest-value.png" :::

1. Select **Save**.

    A message confirms that the app manifest updates successfully.

Developers update the access token version. Next, configure the scope for the access token.

### Configure scope for access token

Developers set up scope (permission) options for the Microsoft Entra app to send the access token to the Teams client and to authorize trusted client applications.

To configure scope and authorize trusted client applications, complete:

* [To configure application ID URI for your app](#to-configure-application-id-uri-for-your-app): Expose a web API and set the application ID URI.
* [To configure API scope for your app](#to-configure-api-scope-for-your-app): Define the API scope and designate which users can consent. Administrators can restrict consent for higher-privileged permissions.
* [To configure an authorized client application](#to-configure-an-authorized-client-application): Create authorized client IDs for applications that receive pre-authorization. This allows app users to access the configured app scopes without further consent.

#### To configure application ID URI for your app

1. Open the [Azure portal](https://ms.portal.azure.com/) in a web browser.

   The Microsoft Azure Bot page opens.

1. Enter the name of the bot resource in the **Search** box, then press **Enter** to open it.

1. Select **Settings** > **Configuration**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-app-menu.png" alt-text="Screenshot shows the Configuration menu." :::

    The **Configuration** page appears.

1. Select **Manage**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-config-manage.png" alt-text="Screenshot shows the Bot resource configuration." :::

    The Microsoft Entra app page appears.

    The new app ID (client ID) appears on this page. Note and save this app ID for updating the app manifest later. If an existing app ID was used, that ID appears.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/aad-app-regd.png" alt-text="Screenshot shows the Bot app page with Application client ID highlighted." :::

1. Select **Manage** > **Expose an API** from the left pane.

    The **Expose an API** page appears.

1. Select **Add** to generate the application ID URI.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/expose-an-api.png" alt-text="Screenshot shows the Set option of Application ID URI." :::

    The section for setting the application ID URI appears.

1. Enter the application ID URI in the required format.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/set-app-id-uri.png" alt-text="Screenshot shows the Application ID URI added." :::

    * The **Application ID URI** is pre-filled with the app ID (GUID) in the format api://{AppID}.

    > [!IMPORTANT]
    >
    > * For a standalone bot, enter the application ID URI as api://botid-{YourBotId}, where {YourBotId} is the Microsoft Entra application ID.
    > * For an app with multiple capabilities (bot, messaging extension, and tab), enter the application ID URI as api://fully-qualified-domain-name.com/botid-{YourClientId}, where {YourClientId} is the bot app ID.
    > * Use lowercase letters for the domain name.
    >
    >   For example, to create an app service with the resource name demoapplication:
    >
    >   | If base resource used is | URL will be... | Format is supported on... |
    >   | --- | --- | --- |
    >   | demoapplication | https://demoapplication.example.net | All platforms. |
    >   | DemoApplication | https://DemoApplication.example.net | Desktop, web, and iOS only (not supported in Android). |
    >
    >    Use the lowercase option demoapplication as the base resource name.

1. Select **Save**.

    A message confirms that the application ID URI updated successfully.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/app-id-uri-msg.png" alt-text="Screenshot shows the Application ID URI updated message." :::

    The application ID URI displays on the page.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/app-id-uri-added.png" alt-text="Screenshot shows the updated Application ID URI." :::

1. Note and save the application ID URI for updating the app manifest later.

The application ID URI is configured. Developers now define the scope and permissions for the app.

> [!div class="nextstepaction"]
> [I ran into an issue](https://github.com/MicrosoftDocs/msteams-docs/issues/new?template=Doc-Feedback.yaml&title=%5BI+ran+into+an+issue%5D+To+configure+application+ID+URI+for+your+app&&author=%40surbhigupta&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fmicrosoftteams%2Fplatform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register&contentSourceUrl=https%3A%2F%2Fgithub.com%2FMicrosoftDocs%2Fmsteams-docs%2Fblob%2Fmain%2Fmsteams-platform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad.md&documentVersionIndependentId=ac68d7e8-2a35-5208-8724-68bd2fdd79b6&platformId=cdaccc16-060c-8eb1-2cee-c1f6a26e285c&metadata=*%2BID%253A%2Be473e1f3-69f5-bcfa-bcab-54b098b59c80%2B%250A*%2BService%253A%2B%2A%2Amsteams%2A%2A)

#### To configure API scope for your app

1. Select **+ Add a scope** in the **Scopes defined by this API** section.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/select-scope.png" alt-text="Screenshot shows the Add a scope option highlighted." :::

    The **Add a scope** page appears.

1. Enter the scope configuration details.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/add-scope.png" alt-text="Screenshot shows how to add scope details in Azure." :::

    1. Enter the scope name.
    2. Select the user who can provide consent for the scope. The default is **Admins only**.
    3. Enter the **Admin consent display name**.
    4. Provide the description for admin consent.
    5. Enter the **User consent display name**.
    6. Provide the user consent description.
    7. Select the **Enabled** option.
    8. Select **Add scope**.

        > [!NOTE]
        > For this tutorial, developers can use openid profile User.Read User.ReadBasic.All as the scope. This scope suits the [Code sample](bot-sso-code.md#code-sample). Additional Graph scopes and permissions may also be added. For more details, see [Extend your app with Microsoft Graph permissions and scopes](bot-sso-graph-api.md).

    A message confirms that the scope was added.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/scope-added-msg.png" alt-text="Screenshot shows the Scope added message." :::

    > [!NOTE]
    > The new scope appears on the page. Note and save the scope for updating the OAuth connection later.

The scope and permissions are configured. Next, configure the authorized client applications for the Microsoft Entra app.

> [!div class="nextstepaction"]
> [I ran into an issue](https://github.com/MicrosoftDocs/msteams-docs/issues/new?template=Doc-Feedback.yaml&title=%5BI+ran+into+an+issue%5D+To+configure+API+scope+for+your+app&&author=%40surbhigupta&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fmicrosoftteams%2Fplatform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad%3Ftabs%3Dwindows%23to-configure-api-scope-for-your-app&contentSourceUrl=https%3A%2F%2Fgithub.com%2FMicrosoftDocs%2Fmsteams-docs%2Fblob%2Fmain%2Fmsteams-platform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad.md&documentVersionIndependentId=ac68d7e8-2a35-5208-8724-68bd2fdd79b6&platformId=cdaccc16-060c-8eb1-2cee-c1f6a26e285c&metadata=*%2BID%253A%2Be473e1f3-69f5-bcfa-bcab-54b098b59c80%2B%250A*%2BService%253A%2B%2A%2Amsteams%2A%2A)

#### To configure an authorized client application

1. Navigate within the **Expose an API** page to the **Authorized client application** section and select **+ Add a client application**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/auth-client-apps.png" alt-text="Screenshot shows the Add a client application option highlighted under Authorized client applications." :::

    The **Add a client application** page appears.

1. Enter the appropriate Microsoft 365 client ID for the applications to be authorized for the app’s web application.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/add-client-app.png" alt-text="Screenshot shows the Client ID added." :::

    > [!NOTE]
    >
    > * The Microsoft 365 client IDs for mobile, desktop, and web applications for Microsoft Teams, Microsoft 365 app, and Outlook are the actual IDs to add.
    > * For an app with a tab app, select either web or SPA, as mobile or desktop client applications do not apply in Microsoft Teams.
    > * Although using the same App ID is recommended, developers can use a different App Registration ID in the webApplicationInfo section of the Microsoft Teams app manifest. This alternative ID differs from the Azure bot App ID and is a valid and supported configuration.
    >   * The botId in the bots section refers to the Azure Bot registration used for messaging and interaction.
    >   * The webApplicationInfo.id refers to the Microsoft Entra App Registration used for authentication (SSO, token acquisition, Graph API access).

1. Select one of the following client IDs:

   | Use client ID | For authorizing... |
   | --- | --- |
   | 1fec8e78-bce4-4aaf-ab1b-5451cc387264 | Microsoft Teams mobile or desktop application |
   | 5e3ce6c0-2b1f-4285-8d4b-75ee78787346 | Microsoft Teams web application |
   | 4765445b-32c6-49b0-83e6-1d93765276ca | Microsoft 365 web application |
   | 0ec893e0-5785-4de6-99da-4ed124e5296c | Microsoft 365 desktop application |
   | d3590ed6-52b3-4102-aeff-aad2292ab01c | Microsoft 365 mobile application </br> Outlook desktop application |
   | bc59ab01-8403-45c6-8796-ac3ef710b3e3 | Outlook web application |
   | 27922004-5251-4030-b22d-91ecd9a37ea4 | Outlook mobile application |
   | c0ab8ce9-e9a0-42e7-b064-33d422df41f1 | Microsoft Edge |

1. Select the application ID URI created for the app in **Authorized scopes** to add its scope to the exposed web API.

1. Select **Add application**.

    A message confirms that the authorized client app was added.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/update-app-auth-msg.png" alt-text="Screenshot shows the Client ID added message." :::

    The authorized app's client ID appears on the page.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/client-app-added.png" alt-text="Screenshot shows the newly added Client ID under Authorized client applications screen." :::

    > [!NOTE]
    > Developers may authorize additional client applications by repeating this procedure.

Developers successfully configure app scope, permissions, and client applications. Note and save the application ID URI. Next, create a client secret for the app.

> [!div class="nextstepaction"]
> [I ran into an issue](https://github.com/MicrosoftDocs/msteams-docs/issues/new?template=Doc-Feedback.yaml&title=%5BI+ran+into+an+issue%5D+To+define+access+token+version&&author=%40surbhigupta&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fmicrosoftteams%2Fplatform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad%3Ftabs%3Dwindows%23to-define-access-token-version&contentSourceUrl=https%3A%2F%2Fgithub.com%2FMicrosoftDocs%2Fmsteams-docs%2Fblob%2Fmain%2Fmsteams-platform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad.md&documentVersionIndependentId=ac68d7e8-2a35-5208-8724-68bd2fdd79b6&platformId=cdaccc16-060c-8eb1-2cee-c1f6a26e285c&metadata=*%2BID%253A%2Be473e1f3-69f5-bcfa-bcab-54b098b59c80%2B%250A*%2BService%253A%2B%2A%2Amsteams%2A%2A)

### Create client secret for your app

A client secret is a string that the app uses to verify its identity when requesting a token.

#### To create a client secret

1. Select **Manage** > **Certificates & secrets**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/client-secret-menu.png" alt-text="Screenshot shows the Certificates and secrets menu option." :::

    The **Certificates & secrets** page appears.

1. Select **+ New client secret**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/client-secret.png" alt-text="Screenshot shows the New client secret option highlighted to add a new client secret." :::

    The **Add a client secret** page appears.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/add-client-secret.png" alt-text="Screenshot shows the Add a client secret page to provide the required details." :::

    1. Enter the description.
    1. Select the duration of validity for the secret.

1. Select **Add**.

   A message confirms that the client secret updates successfully, and the client secret appears on the page.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/client-secret-added.png" alt-text="Screenshot shows the Client secret added message." :::

1. Select the copy button next to the **Value** of the client secret.
1. Save the copied value for updating code later.

   > [!IMPORTANT]
   > Developers must copy the client secret value immediately after creating it since the value appears only once and cannot be viewed again later.

> [!div class="nextstepaction"]
> [I ran into an issue](https://github.com/MicrosoftDocs/msteams-docs/issues/new?template=Doc-Feedback.yaml&title=%5BI+ran+into+an+issue%5D+To+create+a+client+secret&&author=%40surbhigupta&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fmicrosoftteams%2Fplatform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad%3Ftabs%3Dwindows%23to-create-a-client-secret&contentSourceUrl=https%3A%2F%2Fgithub.com%2FMicrosoftDocs%2Fmsteams-docs%2Fblob%2Fmain%2Fmsteams-platform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad.md&documentVersionIndependentId=ac68d7e8-2a35-5208-8724-68bd2fdd79b6&platformId=cdaccc16-060c-8eb1-2cee-c1f6a26e285c&metadata=*%2BID%253A%2Be473e1f3-69f5-bcfa-bcab-54b098b59c80%2B%250A*%2BService%253A%2B%2A%2Amsteams%2A%2A)

### Configure redirect URL for your app

Authentication configuration depends on the platform or device targeted. Developers may need to configure redirect URIs, authentication settings, or platform-specific details.

> [!NOTE]
>
> * If the bot app has not received IT admin consent, app users must grant consent when using the app on another platform for the first time.
> * Implicit grant is not required when SSO is enabled on a bot app.

Developers can configure authentication for multiple platforms as long as each URL is unique.

#### To configure redirect URL for your app

1. Open the registered app in the [Azure portal](https://ms.portal.azure.com/).

1. Select **Manage** > **Authentication** from the left pane.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/azure-portal-platform.png" alt-text="Screenshot shows the Authentication option under Manage." :::

    The **Platform configurations** page appears.

1. Select **+ Add a platform**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/add-platform.png" alt-text="Screenshot shows the Add a platform option under Authentication." :::

    The **Configure platforms** page appears.

1. Select the platform type (Web or SPA) for configuration.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/configure-platform.png" alt-text="Screenshot shows the selection of web platform." :::

    The **Configure Web** page appears.

    > [!NOTE]
    > Configuration details vary based on the platform selected.

1. Enter the configuration details for the selected platform.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/config-web-platform.png" alt-text="Screenshot shows the Configure Web page to provide inputs." :::

    1. Enter a unique redirect URI.
        > [!NOTE]
        >
        > * The URL in **Redirect URIs** is an example.
        > * Developers can customize the OAuth redirect URL for the bot and identity provider based on data residency requirements, whether the bot is in the public cloud, Microsoft Azure Government cloud, or Microsoft Azure operated by 21Vianet. For details, see [OAuth URL support in Azure AI Bot Service](/azure/bot-service/ref-oauth-redirect-urls?view=azure-bot-service-4.0&preserve-view=true).
    1. Enter the front-channel logout URL.
    1. Select the tokens that Microsoft Entra ID sends to the app.

1. Select **Configure**.

    The platform configuration appears on the **Platform configurations** page.

Microsoft Entra app configuration completes here. Next, developers configure the bot resource in Microsoft Entra ID to enable SSO.

<a name='configure-bot-resource-in-azure-ad'></a>

> [!div class="nextstepaction"]
> [I ran into an issue](https://github.com/MicrosoftDocs/msteams-docs/issues/new?template=Doc-Feedback.yaml&title=%5BI+ran+into+an+issue%5D+To+configure+redirect+URL+for+your+app&&author=%40surbhigupta&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fmicrosoftteams%2Fplatform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad%3Ftabs%3Dwindows%23to-configure-redirect-url-for-your-app&contentSourceUrl=https%3A%2F%2Fgithub.com%2FMicrosoftDocs%2Fmsteams-docs%2Fblob%2Fmain%2Fmsteams-platform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad.md&documentVersionIndependentId=ac68d7e8-2a35-5208-8724-68bd2fdd79b6&platformId=cdaccc16-060c-8eb1-2cee-c1f6a26e285c&metadata=*%2BID%253A%2Be473e1f3-69f5-bcfa-bcab-54b098b59c80%2B%250A*%2BService%253A%2B%2A%2Amsteams%2A%2A)

## Configure bot resource in Microsoft Entra ID

Before enabling SSO for the bot app, developers create and configure the bot resource in Microsoft Entra ID. For more details, see [Create Teams conversation bot](../conversations/channel-and-group-conversations.md).

> [!NOTE]
> Ensure that when creating the bot resource, developers select the application ID of the registered Microsoft Entra app.

To enable SSO for the bot resource:

* [Configure messaging endpoint for your bot resource](#configure-messaging-endpoint-for-your-bot-resource)
* [Configure OAuth connection for your bot resource](#configure-oauth-connection-for-your-bot-resource)

### Configure messaging endpoint for your bot resource

The messaging endpoint receives messages for your bot, thereby enabling communication with the bot.

#### To configure messaging endpoint

1. Open the [Azure portal](https://ms.portal.azure.com/) in a web browser.
   The Microsoft Azure Bot page opens.

1. Enter the name of the bot resource in the **Search** box, then press **Enter** to open it.

1. Select **Settings** > **Configuration**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-app-menu.png" alt-text="Screenshot shows the bot Configuration menu." :::

    The **Configuration** page appears.

1. Enter the messaging endpoint URL where the bot receives app users' messages.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/message-endpoint.png" alt-text="Screenshot shows the Messaging endpoint option to add the URL where the bot interacts with the user." :::

1. Select **Apply**.

    The messaging endpoint is configured.

Now, configure the OAuth connection to enable SSO for the bot resource.

> [!div class="nextstepaction"]
> [I ran into an issue](https://github.com/MicrosoftDocs/msteams-docs/issues/new?template=Doc-Feedback.yaml&title=%5BI+ran+into+an+issue%5D+To+configure+messaging+endpoint&&author=%40surbhigupta&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fmicrosoftteams%2Fplatform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad%3Ftabs%3Dwindows%23to-configure-messaging-endpoint&contentSourceUrl=https%3A%2F%2Fgithub.com%2FMicrosoftDocs%2Fmsteams-docs%2Fblob%2Fmain%2Fmsteams-platform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad.md&documentVersionIndependentId=ac68d7e8-2a35-5208-8724-68bd2fdd79b6&platformId=cdaccc16-060c-8eb1-2cee-c1f6a26e285c&metadata=*%2BID%253A%2Be473e1f3-69f5-bcfa-bcab-54b098b59c80%2B%250A*%2BService%253A%2B%2A%2Amsteams%2A%2A)

### Configure OAuth connection for your bot resource

To support SSO, developers update the OAuth connection settings of the bot resource. This process links the bot with details configured for the Microsoft Entra app:

* Microsoft Entra app ID (client ID)
* Tenant ID
* Scope and permissions

With the provided app (client) ID and client secret, the Bot Framework Token Store exchanges the token for a Graph token with defined permissions.

#### To update OAuth connection for your bot resource

1. Open the [Azure portal](https://ms.portal.azure.com/) in a web browser.
   The Microsoft Azure Bot page opens.

1. Enter the name of the Microsoft Entra app in the **Search** box and open the app.

1. Select **Settings** > **Configuration**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-configuration.png" alt-text="Screenshot shows the configure OAUth settings for your bot app." :::

    The **Configuration** page appears.

1. Navigate through the **Configuration** page and select **Add OAuth Connection Settings**.

    The **New Connection Setting** page appears.

1. Enter the OAuth configuration settings for the Azure bot.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/new-config-setting.png" alt-text="Screenshot shows the New Connection Setting to provide the details." :::

    1. Enter a name for the connection setting.
    1. Select the service provider.
    
        The additional configuration fields appear.
    
        :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/new-config-setting-b.png" alt-text="Screenshot shows the additional fields for New Connection Setting." :::

    1. Enter the client ID generated when creating the bot app.
    1. Enter the client secret created for the bot.
    1. Enter the application ID URI of the bot in the **Token Exchange URL**.
    1. Enter the tenant ID.
    1. Enter the scope defined when configuring permissions.

        > [!NOTE]
        > Developers can use openid profile User.Read User.ReadBasic.All as the scope for this tutorial. This scope works with the [Code sample](bot-sso-code.md#code-sample).

1. Select **Save**.
1. Select **Apply**.

After configuring the OAuth connection, developers can select **Test connection** to verify its success.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/test-oauth.png" alt-text="Screenshot shows the Test OAuth connection for your bot resource option." :::

If the connection fails, Microsoft Entra ID displays an error. Developers should verify the configurations and test again.

Congratulations! Developers have completed the following app configurations in Microsoft Entra ID required to enable SSO for the bot app:

* Application ID
* Bot ID
* Access token
  * Application ID URI
  * Scope, permissions, and authorized client IDs
  * Client secret
  * Redirect URL
* Messaging endpoint and OAuth connection

> [!div class="nextstepaction"]
> [I ran into an issue](https://github.com/MicrosoftDocs/msteams-docs/issues/new?template=Doc-Feedback.yaml&title=%5BI+ran+into+an+issue%5D+To+update+OAuth+connection+for+your+bot+resource&&author=%40surbhigupta&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fmicrosoftteams%2Fplatform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad%3Ftabs%3Dwindows%23to-update-oauth-connection-for-your-bot-resource&contentSourceUrl=https%3A%2F%2Fgithub.com%2FMicrosoftDocs%2Fmsteams-docs%2Fblob%2Fmain%2Fmsteams-platform%2Fbots%2Fhow-to%2Fauthentication%2Fbot-sso-register-aad.md&documentVersionIndependentId=ac68d7e8-2a35-5208-8724-68bd2fdd79b6&platformId=cdaccc16-060c-8eb1-2cee-c1f6a26e285c&metadata=*%2BID%253A%2Be473e1f3-69f5-bcfa-bcab-54b098b59c80%2B%250A*%2BService%253A%2B%2A%2Amsteams%2A%2A)

---

## Best practices

* Keep the Microsoft Entra app registration restricted to its original purpose as a service-to-service application.
* For enhanced control over disabling authentication connections, rolling secrets, or reusing the Microsoft Entra app with other applications, create an additional Microsoft Entra app for any user-to-service authentication.

Using a single Microsoft Entra registration app for authentication might lead to these issues:

* Renewing the certificate attached to the Microsoft Entra app registration may affect users who have authenticated with other Microsoft Entra services using that certificate.
* It establishes a single point of failure and control for all authentication-related activities for the bot.

## Next step

> [!div class="nextstepaction"]
> [Add code to enable SSO](bot-sso-code.md)