---
title: Configure your app in Microsoft Entra ID
description: Describes configuring your bot or message extension app with Microsoft Entra ID for enabling SSO.
ms.topic: how-to
ms.localizationpriority: high
---
# Configure your app in Microsoft Entra ID

Microsoft Entra ID provides app users access to your bot or message extension app. The app user who has signed in to Teams can be given access to your app.

<a name='sso-configuration-in-azure-ad-portal'></a>

## SSO configuration in Microsoft Entra admin center

The bot and message extension apps use Bot Framework for communicating with app users and implementing authentication.

To configure SSO for your bot or message extension app, you'll need to:

- Configure bot resource in Microsoft Entra ID
- Configure app in Microsoft Entra ID

> [!NOTE]
> Ensure that you've created an app and a bot resource in Microsoft Entra ID.
>
> - For more information about creating an app in Microsoft Entra ID, see [Register a new app in Microsoft Entra ID](../../../tabs/how-to/authentication/tab-sso-register-aad.md#to-register-a-new-app-in-azure-ad).
> - For more information about creating and configuring your bot resource in Microsoft Entra ID, see [Create Teams conversation bot](../../../sbs-teams-conversation-bot.yml).

You can configure your bot resource and app in Microsoft Entra ID for your bot or message extension app in one of the following two ways:

- **Configure SSO using bot resource and configure Microsoft Entra app**: You can start by configuring SSO for your bot resource, and enable SSO for your Microsoft Entra app. You'll configure:

  - For bot resource: Messaging endpoint and OAuth connection.

    > [!NOTE]
    > When you create your bot resource in Microsoft Entra ID, you can select the option for creating a new app ID, or you can use an existing app ID if you've already registered your app in Microsoft Entra ID.

  - For Microsoft Entra app: App ID URI, scope and permissions, trusted client IDs, access token version, client secret, and redirect URL.

- **Configure SSO using Microsoft Entra app and then configuring bot resource**: You can start by configuring your Microsoft Entra app, and then use this app ID in the bot resource when you enable SSO for it. You'll configure:

  - For Microsoft Entra app: App ID URI, access token, trusted client IDs, access token version, client secret, and redirect URL.

  - For bot resource: Messaging endpoint and OAuth connection.

    > [!NOTE]
    > Configure bot resource using the app ID generated by Microsoft Entra ID when you registered your app.

<a name='enable-sso-in-azure-ad'></a>

## Enable SSO in Microsoft Entra ID

By the end of this tutorial, you'll learn to configure:

- Application ID
- Bot ID
- Access token
  - Application ID URI
  - Scope, permissions, and authorized client IDs
  - Client secret
  - Redirect URL
- Messaging endpoint and OAuth connection

Select one of the following two ways to configure SSO for your bot resource:

# [Use bot resource and configure Microsoft Entra app](#tab/botid)

To enable SSO for your app in Microsoft Entra ID:

- **[Configure messaging endpoint](#configure-messaging-endpoint)**
- **[Configure SSO for Microsoft Entra app](#configure-sso-for-azure-ad-app)**:
  - [Configure scope for the access token](#configure-scope-for-the-access-token)
  - [Configure access token version](#configure-access-token-version)
  - [Create client secret](#create-client-secret)
  - [Configure redirect URL](#configure-redirect-url)
- **[Configure OAuth connection](#configure-oauth-connection)**

> [!IMPORTANT]
> Ensure that when you create your bot resource, select the option to create a new app ID. You can also use an existing app ID, if you've already registered an app in Microsoft Entra admin center.

## Configure messaging endpoint

Messaging endpoint is where messages are sent to your bot. It enables communication with your bot.

### To configure messaging endpoint for your bot resource

1. Open the [Azure portal](https://ms.portal.azure.com/) on your web browser.
   The Microsoft Azure Bot page opens.

1. Enter the name of your bot resource in **Search** box, and select **Enter** to open it.

1. Select **Settings** > **Configuration**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-app-menu.png" alt-text="Screenshot shows the bot Configuration menu.":::

    The **Configuration** page appears.

1. Enter the messaging endpoint URL where your bot receives app user's messages.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/message-endpoint.png" alt-text="Screenshot shows the Messaging endpoint option to add the URL where the bot interacts with the user." :::

1. Select **Apply**.

    The messaging endpoint is configured.

You've configured the messaging endpoint for your bot resource. Next, you must enable SSO for the Microsoft Entra app.

<a name='configure-sso-for-azure-ad-app'></a>

## Configure SSO for Microsoft Entra app

You must configure permissions and scopes, authorize client applications, update app manifest (previously called Teams app manifest), and create client secret for your Microsoft Entra app. These configurations help to invoke SSO for your bot app.

### Configure scope for the access token

Configure scope (permission) options for sending access token to Teams client and authorizing trusted client applications to enable SSO.

You need:

- [To configure application ID URI](#to-configure-application-id-uri): Configure scope (permission) options for your app. You'll expose a web API and configure the application ID URI.
- [To configure API scope](#to-configure-api-scope): Define scope for the API, and the users who can consent for a scope. You can let only admins provide consent for higher-privileged permissions.
- [To configure authorized client application](#to-configure-authorized-client-application): Create authorized client IDs for applications that you want to pre-authorize. It allows the app user to access the app scopes (permissions) you've configured, without requiring any further consent. Pre-authorize only those client applications you trust, as your app users won't have the opportunity to decline consent.

#### To configure application ID URI

1. Open the [Azure portal](https://ms.portal.azure.com/) on your web browser.

   The Microsoft Azure Bot page opens.

1. Enter the name of your bot resource in **Search** box, and then select **Enter** to open it.

1. Select **Settings** > **Configuration**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-app-menu.png" alt-text="Screenshot shows the bot Configuration menu under Settings.":::

    The **Configuration** page appears.

1. Select **Manage**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-config-manage.png" alt-text="Screenshot shows the Bot resource configuration." :::

    The Microsoft Entra app page appears.

    The new app ID (client ID) for the app appears on this page. Note and save this app ID. You'll need to update it in the app manifest later. If you used the ID of an existing app when you created the bot resource, then ID of that app appears in this page.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/aad-app-regd.png" alt-text="Screenshot shows the Bot app page with Application client ID highlighted.":::

1. Select **Manage** > **Expose an API** from the left pane.

    The **Expose an API** page appears.

1. Select **Add** to generate application ID URI.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/expose-an-api.png" alt-text="Screenshot shows the Set option of Application ID URI." :::

    The section for setting application ID URI appears.

1. Enter the application ID URI in the format explained here.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/set-app-id-uri.png" alt-text="Screenshot shows the Application ID URI added." :::

    - The **Application ID URI** is prefilled with app ID (GUID) in the format `api://{AppID}`.

    > [!IMPORTANT]
    >
    > - **Sensitive information**: The application ID URI is logged as part of the authentication process and must not contain sensitive information.
    >
    > - **Standalone bot**: If you're building a standalone bot, enter the application ID URI as api://botid-{YourBotId}. Here, {YourBotId} is your Microsoft Entra application ID.
    > - **Application ID URI for app with multiple capabilities**: If you're building an app with a bot, a messaging extension, and a tab, enter the application ID URI as `api://fully-qualified-domain-name.com/botid-{YourClientId}`, where `{YourClientId}` is your bot app ID.
    >
    > - **Format for domain name**: Use lowercase letters for domain name. Don't use upper case.
    >
    >   For example, to create an app service or web app with resource name, 'demoapplication':
    >
    >   | If base resource name used is | URL will be... | Format is supported on... |
    >   | --- | --- | --- |
    >   | *demoapplication* | `https://demoapplication.example.net` | All platforms.|
    >   | *DemoApplication* | `https://DemoApplication.example.net` | Desktop, web, and iOS only. It isn't supported in Android. |
    >
    >    Use the lowercase option *demoapplication* as base resource name.

1. Select **Save**.

    A message appears on the browser stating that the application ID URI was updated.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/app-id-uri-msg.png" alt-text="Screenshot shows the Application ID URI updated message." :::

    The application ID URI displays on the page.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/app-id-uri-added.png" alt-text="Screenshot shows the updated Application ID URI." :::

1. Note and save the application ID URI. You'll need it for updating the app manifest later.

The application ID URI is configured. You can now define scope and permissions for your app.

#### To configure API scope

1. Select **+ Add a scope** in the **Scopes defined by this API** section.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/select-scope.png" alt-text="Screenshot shows the Add a scope option highlighted." :::

    The **Add a scope** page appears.

1. Enter the details for configuring scope.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/add-scope.png" alt-text="Screenshot shows how to add scope details in Azure.":::

    1. Enter the scope name.
    2. Select the user who can give consent for this scope. The default option is **Admins only**.
    3. Enter the **Admin consent display name**.
    4. Enter the description for admin consent.
    5. Enter the **User consent display name**.
    6. Enter the user consent description.
    7. Select the **Enabled** option for state.
    8. Select **Add scope**.

        > [!NOTE]
        > For this tutorial, you can use openid profile `User.Read User.ReadBasic.All` as scope. This scope is suitable for using the [Code sample](bot-sso-code.md#code-sample). You can also add more Graph scopes and permissions. For more information, see [Extend your app with Microsoft Graph permissions and scopes](bot-sso-graph-api.md).

    A message appears on the browser stating that the scope was added.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/scope-added-msg.png" alt-text="Screenshot shows the Scope added message." :::

    > [!NOTE]
    > The new scope you defined displays on the page. Ensure that you note and save the scope that you've configured. You'll need it to update OAuth connection later.

The scope and permissions are now configured. Next, you must configure the authorized client applications for your Microsoft Entra app.

#### To configure authorized client application

1. Move through the **Expose an API** page to the **Authorized client application** section, and select **+ Add a client application**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/auth-client-apps.png" alt-text="Screenshot shows the Add a client application option highlighted under Authorized client applications." :::

    The **Add a client application** page appears.

1. Enter the appropriate Microsoft 365 client ID for the applications that you want to authorize for your app’s web application.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/add-client-app.png" alt-text="Screenshot shows the Client ID added." :::

    > [!NOTE]
    >
    > - The Microsoft 365 client IDs for mobile, desktop, and web applications for Teams, Microsoft 365 app, and Outlook are the actual IDs that you must add.
    > - If your app has a tab app, you'll need either web or SPA, as you can't have a mobile or desktop client application in Teams.

1. Select one of the following client IDs:

   | Use client ID | For authorizing... |
   | --- | --- |
   | 1fec8e78-bce4-4aaf-ab1b-5451cc387264 | Teams mobile or desktop application |
   | 5e3ce6c0-2b1f-4285-8d4b-75ee78787346 | Teams web application |
   | 4765445b-32c6-49b0-83e6-1d93765276ca | Microsoft 365 web application |
   | 0ec893e0-5785-4de6-99da-4ed124e5296c | Microsoft 365 desktop application |
   | d3590ed6-52b3-4102-aeff-aad2292ab01c | Microsoft 365 mobile application </br> Outlook desktop application |
   | bc59ab01-8403-45c6-8796-ac3ef710b3e3 | Outlook web application |
   | 27922004-5251-4030-b22d-91ecd9a37ea4 | Outlook mobile application |

1. Select the application ID URI you created for your app in **Authorized scopes** to add the scope to the web API you exposed.

1. Select **Add application**.

    A message appears on the browser stating that the authorized client app was added.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/update-app-auth-msg.png" alt-text="Screenshot shows the Client ID added message." :::

    The authorized app's client ID displays on the page.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/client-app-added.png" alt-text="Screenshot shows the newly added Client ID under Authorized client applications screen." :::

    > [!NOTE]
    > You can authorize more than one client application. Repeat the steps of this procedure for configuring another authorized client application.

You've successfully configured app scope, permissions, and client applications. Ensure that you note and save the application ID URI. Next, you configure the access token version.

### Configure access token version

You must define the access token version for your app in the Microsoft Entra app manifest.

#### To define the access token version

1. Select **Manage** > **Manifest** from the left pane.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/azure-portal-manifest.png" alt-text="Screenshot shows the Microsoft Entra admin center Manifest." :::

    The Microsoft Entra app manifest appears.

1. Enter **2** as the value for the `accessTokenAcceptedVersion` property.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/azure-manifest-value.png" alt-text="Screenshot shows the Value for accepted access token version." :::

1. Select **Save**.

    A message appears on the browser stating that the app manifest was updated successfully.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/update-aad-manifest-msg.png" alt-text="Screenshot shows the Manifest updated message.":::

You've updated the access token version. Next, you'll create a client secret for your app.

### Create client secret

A client secret is a string that the application uses to prove its identity when requesting a token.

#### To create a client secret for your app

1. Select **Manage** > **Certificates & secrets**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/client-secret-menu.png" alt-text="Screenshot shows the Certificates and secrets menu option.":::

    The **Certificates & secrets** page appears.

1. Select **+ New client secret**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/client-secret.png" alt-text="Screenshot shows the New client secret option highlighted to add a new client secret.":::

   The **Add a client secret** page appears.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/add-client-secret.png" alt-text="Screenshot shows the Add a client secret page to provide the required details." :::

    1. Enter the description.
    1. Select the duration of validity for the secret.

1. Select **Add**.

   A message appears on the browser stating that the client secret was updated, and the client secret displays on the page.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/client-secret-added.png" alt-text="Screenshot shows the Client secret added message.":::

1. Select the copy button next to the **Value** of client secret.
1. Save the value that you copied. You'll need it later for updating code.

   > [!IMPORTANT]
   > Ensure that you copy the value of client secret right after you create it. The value is visible only at the time when the client secret is created, and it can't be viewed after that.

You've configured the client secret. Next, you must configure the redirect URL.

### Configure redirect URL

Configuration for authentication depends on the platform or device where you want to target your app. You may need to configure redirect URIs, authentication settings, or platform-specific details.

> [!NOTE]
>
> - If your bot app hasn't been granted IT admin consent, app users have to provide consent the first time they use your app on a different platform.
> - Implicit grant is not required if SSO is enabled on a bot app.

You can configure authentication for multiple platforms as long as the URL is unique.

#### To configure redirect URL

1. Open the app you registered in the [Azure portal](https://ms.portal.azure.com/).

1. Select **Manage** > **Authentication** from the left pane.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/azure-portal-platform.png" alt-text="Screenshot shows the Authentication option under Manage." :::

    The **Platform configurations** page appears.

1. Select **+ Add a platform**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/add-platform.png" alt-text="Screenshot shows the Add a platform option under Authentication." :::

    The **Configure platforms** page appears.

1. Select the platform that you want to configure for your app. You can select the platform type from Web or SPA.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/configure-platform.png" alt-text="Screenshot shows the selection of web platform." :::

    <!--You can configure multiple platforms for a particular platform type. Ensure that the redirect URI is unique for every platform you configure.-->

    The **Configure Web** page appears.

    > [!NOTE]
    > The configurations will be different based on the platform you select.

1. Enter the configuration details for the platform.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/config-web-platform.png" alt-text="Screenshot shows the Configure Web page to provide inputs." :::

    1. Enter the redirect URI. The URI should be unique.

        > [!NOTE]
        > The URL mentioned in **Redirect URIs** is an example.

    1. Enter the front-channel logout URL.
    1. Select the tokens you want Microsoft Entra ID to send for your app.

1. Select **Configure**.

    The platform is configured and displayed in the **Platform configurations** page.

The Microsoft Entra app configuration is complete, and now you must enable SSO support for your bot resource by configuring OAuth connection.

## Configure OAuth connection

For a bot to support SSO, you must update its OAuth connection settings. This process associates the bot with app details that you configured for your Microsoft Entra app:

- Microsoft Entra app ID, which is the client ID
- Tenant ID
- Scope and permissions

With the app (client) ID and client secret provided, the Bot Framework Token Store exchanges the token for a graph token with defined permissions.

### To update OAuth connection

1. Open the [Azure portal](https://ms.portal.azure.com/) on your web browser.
   The Microsoft Azure Bot page opens.

1. Enter the name of your Microsoft Entra app in **Search** box, and open your app.

1. Select **Settings** > **Configuration**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-configuration.png" alt-text="Screenshot shows the configure OAUth settings for your bot app." :::

    The **Configuration** page appears.

1. Move through the **Configuration** page and select **Add OAuth Connection Settings**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-oauth-connection.png" alt-text="Screenshot shows the Add OAuth Connection Settings option highlighted.":::

    The **New Connection Setting** page appears.

1. Enter the OAuth configuration settings for the Azure bot.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/new-config-setting.png" alt-text="Screenshot shows the New Connection Setting to provide the details." :::

    1. Enter a name for the configuration setting.
    1. Select the service provider.

        The remaining configuration details appear.

        :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/new-config-setting-b.png" alt-text="Screenshot shows the additional fields for New Connection Setting." :::

    1. Enter the app (client) ID for the Microsoft Entra app.
    1. Enter the client secret that you've created for your bot.
    1. Enter the application ID URI of your bot in the **Token Exchange URL**.
    1. Enter the tenant ID.
    1. Enter the scope that you defined when you configured the scope and permissions.

1. Select **Save**.
1. Select **Apply**.

    After you've configured the OAuth connection, you can select **Test connection** to check if the OAuth connection is successful.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/test-oauth.png" alt-text="Screenshot shows the Test OAuth connection for your bot resource option.":::

    If the connection isn't successful, Microsoft Entra ID displays an error. You can verify all the configurations and test again.

Congratulations! You've completed the following app configurations in Microsoft Entra ID required to enable SSO for your bot app:

- Application ID
- Bot ID
- Access token
  - Application ID URI
  - Scope, permissions, and authorized client IDs
  - Client secret
  - Redirect URL
- Messaging endpoint and OAuth connection

# [Use Microsoft Entra app and then configure bot resource](#tab/windows)

To create and configure your app for enabling SSO in Microsoft Entra ID:

- [**Configure your Microsoft Entra app for SSO**](#configure-your-azure-ad-app-for-sso)
  - [Configure scope for access token](#configure-scope-for-access-token)
  - [Configure the access token version](#configure-the-access-token-version)
  - [Create client secret for your app](#create-client-secret-for-your-app)
  - [Configure redirect URL for your app](#configure-redirect-url-for-your-app)
- [**Configure bot resource in Microsoft Entra ID**](#configure-bot-resource-in-azure-ad)
  - [Configure messaging endpoint for your bot resource](#configure-messaging-endpoint-for-your-bot-resource)
  - [Configure OAuth connection for your bot resource](#configure-oauth-connection-for-your-bot-resource)

<a name='configure-your-azure-ad-app-for-sso'></a>

## Configure your Microsoft Entra app for SSO

You must configure permissions and scopes, authorize client applications, update app manifest, and create client secret for your Microsoft Entra app. These configurations help invoke SSO for your bot app.

> [!IMPORTANT]
> Ensure that you've [registered your app](../../../tabs/how-to/authentication/tab-sso-register-aad.md#to-register-a-new-app-in-azure-ad) in Microsoft Entra ID. At registration, Microsoft Entra ID generates a new app ID that you must note. You'll need to update it later in the app manifest file.

### Configure scope for access token

You must configure scope (permission) options for your Microsoft Entra app. You need it for sending access token to Teams client and authorize trusted client applications.

To configure scope and authorize trusted client applications, you'll need:

- [To configure application ID URI for your app](#to-configure-application-id-uri-for-your-app): Configure scope (permission) options for your app. You'll expose a web API and configure the application ID URI.
- [To configure API scope for your app](#to-configure-api-scope-for-your-app): Define scope for the API and the users who can consent for a scope. You can let only admins provide consent for higher-privileged permissions.
- [To configure an authorized client application](#to-configure-an-authorized-client-application): Create authorized client IDs for applications that you want to pre-authorize. It allows the app user to access the app scopes (permissions) you've configured, without requiring any further consent. Pre-authorize only those client applications you trust as your app users won't have the opportunity to decline consent.

#### To configure application ID URI for your app

1. Open the [Azure portal](https://ms.portal.azure.com/) on your web browser.

   The Microsoft Azure Bot page opens.

1. Enter the name of your bot resource in **Search** box, and then select **Enter** to open it.

1. Select **Settings** > **Configuration**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-app-menu.png" alt-text="Screenshot shows the Configuration menu.":::

    The **Configuration** page appears.

1. Select **Manage**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-config-manage.png" alt-text="Screenshot shows the Bot resource configuration." :::

    The Microsoft Entra app page appears.

    The new app ID (client ID) for the app appears on this page. Note and save this app ID. You'll need to update it in the app manifest later. If you used the ID of an existing app when you created the bot resource, then ID of that app appears in this page.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/aad-app-regd.png" alt-text="Screenshot shows the Bot app page with Application client ID highlighted.":::

1. Select **Manage** > **Expose an API** from the left pane.

    The **Expose an API** page appears.

1. Select **Add** to generate application ID URI.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/expose-an-api.png" alt-text="Screenshot shows the Set option of Application ID URI." :::

    The section for setting application ID URI appears.

1. Enter the application ID URI in the format explained here.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/set-app-id-uri.png" alt-text="Screenshot shows the Application ID URI added." :::

    - The **Application ID URI** is pre-filled with app ID (GUID) in the format `api://{AppID}`.

    > [!IMPORTANT]
    >
    > - **Standalone bot**: If you're building a standalone bot, enter the application ID URI as api://botid-{YourBotId}. Here, {YourBotId} is your Microsoft Entra application ID.
    > - **Application ID URI for app with multiple capabilities**: If you're building an app with a bot, a messaging extension, and a tab, enter the application ID URI as `api://fully-qualified-domain-name.com/botid-{YourClientId}`, where `{YourClientId}` is your bot app ID.
    >
    > - **Format for domain name**: Use lowercase letters for domain name. Don't use upper case.
    >
    >   For example, to create an app service or web app with resource name, 'demoapplication':
    >
    >   | If base resource name used is | URL will be... | Format is supported on... |
    >   | --- | --- | --- |
    >   | *demoapplication* | `https://demoapplication.example.net` | All platforms.|
    >   | *DemoApplication* | `https://DemoApplication.example.net` | Desktop, web, and iOS only. It isn't supported in Android. |
    >
    >    Use the lowercase option *demoapplication* as base resource name.

1. Select **Save**.

    A message appears on the browser stating that the application ID URI was updated.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/app-id-uri-msg.png" alt-text="Screenshot shows the Application ID URI updated message." :::

    The application ID URI displays on the page.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/app-id-uri-added.png" alt-text="Screenshot shows the updated Application ID URI." :::

1. Note and save the application ID URI. You'll need it for updating the app manifest later.

The application ID URI is configured. You can now define scope and permissions for your app.

#### To configure API scope for your app

1. Select **+ Add a scope** in the **Scopes defined by this API** section.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/select-scope.png" alt-text="Screenshot shows the Add a scope option highlighted." :::

    The **Add a scope** page appears.

1. Enter the details for configuring scope.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/add-scope.png" alt-text="Screenshot shows how to add scope details in Azure.":::

    1. Enter the scope name.
    1. Select the user who can give consent for this scope. The default option is **Admins only**.
    1. Enter the **Admin consent display name**.
    1. Enter the description for admin consent.
    1. Enter the **User consent display name**.
    1. Enter the user consent description.
    1. Select the **Enabled** option for state.
    1. Select **Add scope**.

        > [!NOTE]
        > For this tutorial, you can use openid profile User.Read User.ReadBasic.All as scope. This scope is suitable for using the [Code sample](bot-sso-code.md#code-sample). You can also add more Graph scopes and permissions. For more information, see [Extend your app with Microsoft Graph permissions and scopes](bot-sso-graph-api.md).

    A message appears on the browser stating that the scope was added.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/scope-added-msg.png" alt-text="Screenshot shows the Scope added message." :::

    > [!NOTE]
    > The new scope you defined displays on the page. Ensure that you note and save the scope that you've configured. You'll need it to update OAuth connection later.

The scope and permissions are now configured. Next, you must configure the authorized client applications for your Microsoft Entra app.

#### To configure an authorized client application

1. Move through the **Expose an API** page to the **Authorized client application** section, and select **+ Add a client application**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/auth-client-apps.png" alt-text="Screenshot shows the Add a client application option highlighted under Authorized client applications." :::

    The **Add a client application** page appears.

1. Enter the appropriate Microsoft 365 client ID for the applications that you want to authorize for your app’s web application.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/add-client-app.png" alt-text="Screenshot shows the Client ID added." :::

    > [!NOTE]
    >
    > - The Microsoft 365 client IDs for mobile, desktop, and web applications for Teams, Microsoft 365 app, and Outlook are the actual IDs that you must add.
    > - If your app has a tab app, you'll need either web or SPA, as you can't have a mobile or desktop client application in Teams.

1. Select one of the following client IDs:

   | Use client ID | For authorizing... |
   | --- | --- |
   | 1fec8e78-bce4-4aaf-ab1b-5451cc387264 | Teams mobile or desktop application |
   | 5e3ce6c0-2b1f-4285-8d4b-75ee78787346 | Teams web application |
   | 4765445b-32c6-49b0-83e6-1d93765276ca | Microsoft 365 web application |
   | 0ec893e0-5785-4de6-99da-4ed124e5296c | Microsoft 365 desktop application |
   | d3590ed6-52b3-4102-aeff-aad2292ab01c | Microsoft 365 mobile application </br> Outlook desktop application |
   | bc59ab01-8403-45c6-8796-ac3ef710b3e3 | Outlook web application |
   | 27922004-5251-4030-b22d-91ecd9a37ea4 | Outlook mobile application |

1. Select the application ID URI you created for your app in **Authorized scopes** to add the scope to the web API you exposed.

1. Select **Add application**.

    A message appears on the browser stating that the authorized client app was added.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/update-app-auth-msg.png" alt-text="Screenshot shows the Client ID added message." :::

    The authorized app's client ID displays on the page.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/client-app-added.png" alt-text="Screenshot shows the newly added Client ID under Authorized client applications screen." :::

    > [!NOTE]
    > You can authorize more than one client application. Repeat the steps of this procedure for configuring another authorized client application.

You've successfully configured app scope, permissions, and client applications. Ensure that you note and save the application ID URI. Next, you configure the access token version.

### Configure the access token version

You must define the access token version for your app in the Microsoft Entra app manifest.

#### To define access token version

1. Select **Manage** > **Manifest** from the left pane.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/azure-portal-manifest.png" alt-text="Screenshot shows the Microsoft Entra admin center Manifest." :::

    The Microsoft Entra app manifest appears.

1. Enter **2** as the value for the `accessTokenAcceptedVersion` property.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/azure-manifest-value.png" alt-text="Screenshot shows the Value for accepted access token version." :::

1. Select **Save**.

    A message appears on the browser stating that the app manifest was updated successfully.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/update-aad-manifest-msg.png" alt-text="Screenshot shows the Manifest updated message.":::

You've updated the access token version. Next step is to create a client secret for your app next.

### Create client secret for your app

A client secret is a string that the application uses to prove its identity when requesting a token.

#### To create a client secret

1. Select **Manage** > **Certificates & secrets**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/client-secret-menu.png" alt-text="Screenshot shows the Certificates and secrets menu option.":::

    The **Certificates & secrets** page appears.

1. Select **+ New client secret**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/client-secret.png" alt-text="Screenshot shows the New client secret option highlighted to add a new client secret.":::

   The **Add a client secret** page appears.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/add-client-secret.png" alt-text="Screenshot shows the Add a client secret page to provide the required details." :::

    1. Enter the description.
    1. Select the duration of validity for the secret.

1. Select **Add**.

   A message appears on the browser stating that the client secret was updated, and the client secret displays on the page.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/client-secret-added.png" alt-text="Screenshot shows the Client secret added message.":::

1. Select the copy button next to the **Value** of client secret.
1. Save the value that you copied. You'll need it later for updating code.

   > [!IMPORTANT]
   > Ensure that you copy the value of client secret right after you create it. The value is visible only at the time when the client secret is created, and it can't be viewed after that.

### Configure redirect URL for your app

Configuration for authentication depends on the platform or device where you want to target your app. You may need to configure redirect URIs, authentication settings, or platform-specific details.

> [!NOTE]
>
> - If your bot app hasn't been granted IT admin consent, app users have to provide consent the first time they use your app on a different platform.
> - Implicit grant is not required if SSO is enabled on a bot app.

You can configure authentication for multiple platforms as long as the URL is unique.

#### To configure redirect URL for your app

1. Open the app you registered in the [Azure portal](https://ms.portal.azure.com/).

1. Select **Manage** > **Authentication** from the left pane.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/azure-portal-platform.png" alt-text="Screenshot shows the Authentication option under Manage." :::

    The **Platform configurations** page appears.

1. Select **+ Add a platform**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/add-platform.png" alt-text="Screenshot shows the Add a platform option under Authentication." :::

    The **Configure platforms** page appears.

1. Select the platform that you want to configure for your app. You can select the platform type from web or SPA.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/configure-platform.png" alt-text="Screenshot shows the selection of web platform." :::

    The **Configure Web** page appears.

    > [!NOTE]
    > The configurations will be different based on the platform you select.

1. Enter the configuration details for the platform.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/config-web-platform.png" alt-text="Screenshot shows the Configure Web page to provide inputs." :::

    1. Enter the redirect URI. The URI should be unique.

        > [!NOTE]
        > The URL mentioned in **Redirect URIs** is an example.

    1. Enter the front-channel logout URL.
    1. Select the tokens you want Microsoft Entra ID to send for your app.

1. Select **Configure**.

    The platform is configured and displayed in the **Platform configurations** page.

The configuration for Microsoft Entra app is complete, and now you can configure your bot resource for enabling SSO.

<a name='configure-bot-resource-in-azure-ad'></a>

## Configure bot resource in Microsoft Entra ID

Before you enable SSO for your bot app, you must create and configure your bot resource in Microsoft Entra ID. For more information, see [Create Teams conversation bot](../../../sbs-teams-conversation-bot.yml).

> [!NOTE]
> Ensure that when you create your bot resource, you select the application ID of your Microsoft Entra app that you registered.

To enable SSO for your bot resource:

- [Configure messaging endpoint for your bot resource](#configure-messaging-endpoint-for-your-bot-resource)
- [Configure OAuth connection for your bot resource](#configure-oauth-connection-for-your-bot-resource)

### Configure messaging endpoint for your bot resource

Messaging endpoint is where messages are sent to your bot. It enables communication with your bot.

#### To configure messaging endpoint

1. Open the [Azure portal](https://ms.portal.azure.com/) on your web browser.
   The Microsoft Azure Bot page opens.

1. Enter the name of your bot resource in **Search** box, and select **Enter** to open it.

1. Select **Settings** > **Configuration**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-app-menu.png" alt-text="Screenshot shows the bot Configuration menu.":::

    The **Configuration** page appears.

1. Enter the messaging endpoint URL where your bot receives app user's messages.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/message-endpoint.png" alt-text="Screenshot shows the Messaging endpoint option to add the URL where the bot interacts with the user." :::

1. Select **Apply**.

    The messaging endpoint is configured.

Now, you must configure the OAuth connection to enable SSO for your bot resource.

### Configure OAuth connection for your bot resource

For a bot to support SSO, you must update its OAuth connection settings. This process associates the bot with app details that you configured for your Microsoft Entra app:

- Microsoft Entra app ID, which is the client ID
- Tenant ID
- Scope and permissions

With the app (client) ID and client secret provided, the Bot Framework Token Store exchanges the token for a graph token with defined permissions.

#### To update OAuth connection for your bot resource

1. Open the [Azure portal](https://ms.portal.azure.com/) on your web browser.
   The Microsoft Azure Bot page opens.

1. Enter the name of your Microsoft Entra app in **Search** box, and open your app.

1. Select **Settings** > **Configuration**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/bot-configuration.png" alt-text="Screenshot shows the configure OAUth settings for your bot app." :::

    The **Configuration** page appears.

1. Move through the **Configuration** page and select **Add OAuth Connection Settings**.

    The **New Connection Setting** page appears.

1. Enter the OAuth configuration settings for the Azure bot.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/new-config-setting.png" alt-text="Screenshot shows the New Connection Setting to provide the details." :::

    1. Enter a name for the configuration setting.
    1. Select the service provider.

        The remaining configuration details appear.

        :::image type="content" source="../../../assets/images/authentication/teams-sso-bots/new-config-setting-b.png" alt-text="Screenshot shows the additional fields for New Connection Setting." :::

    1. Enter the client ID that was generated when you created the bot app.
    1. Enter the client secret that you've created for your bot.
    1. Enter the application ID URI of your bot in the **Token Exchange URL**.
    1. Enter the tenant ID.
    1. Enter the scope that you defined when you configured the permissions.

        > [!NOTE]
        > For this tutorial, you can use openid profile User.Read User.ReadBasic.All as scope. This scope is suitable for using the [Code sample](bot-sso-code.md#code-sample).

1. Select **Save**.
1. Select **Apply**.

After you've configured the OAuth connection, you can select **Test connection** to check if the OAuth connection is successful.

:::image type="content" source="../../../assets/images/authentication/teams-sso-bots/test-oauth.png" alt-text="Screenshot shows the Test OAuth connection for your bot resource option.":::

If the connection isn't successful, Microsoft Entra ID displays an error. You can verify all configurations and test again.

Congratulations! You've completed the following app configurations in Microsoft Entra ID required to enable SSO for your bot app:

- Application ID
- Bot ID
- Access token
  - Application ID URI
  - Scope, permissions, and authorized client IDs
  - Client secret
  - Redirect URL
- Messaging endpoint and OAuth connection

---

## Best practices

- Keep the Microsoft Entra app registration restricted to its original purpose of service to service application.
- For better control over disabling authentication connections, rolling secrets, or reusing the Microsoft Entra app with other applications, create an additional Microsoft Entra app for any user to service authentication.

If you use the Microsoft Entra registration app for authentication, you might encounter the following issues:

- If you renew the certificate attached to the Microsoft Entra app registration, it affects the users who have authenticated with other Microsoft Entra services using the certificate.
- It creates a single point of failure and control for all authentication-related activities with the bot.

## Next step

> [!div class="nextstepaction"]
> [Add code to enable SSO](bot-sso-code.md)
