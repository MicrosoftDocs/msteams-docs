---
title: Custom engine agent user experience
description: Learn about the user experience for custom engine agent
ms.localizationpriority: medium
ms.topic: overview
ms.author: surbhigupta
ms.date: 09/27/2024
---

# Build custom engine agent user experience

A custom engine agent transforms system interactions. For UX designers and developers, creating an exceptional user experience is crucial. This article details the steps, principles, and considerations for designing intuitive, user-centered interfaces that seamlessly integrate AI capabilities. The main goals are to simplify complex tasks, enhance productivity, and offer personalized experiences through adaptive learning. A custom engine agent includes features that enhance its functionality and integration within the Microsoft ecosystem:

- **Generative AI integration**: Uses advanced AI models for natural language processing and interaction.
- **Bots**: Allows building or extending bots with LLM and generative AI for high-quality chat experiences.
- **Customizable orchestration**: Provides extensive customization options for tailoring the agent's behavior and responses to specific use cases.

To achieve this, you must follow mandatory requirements and best practices.

## Ensure mandatory requirements for custom engine agent

The following requirements are mandatory for building the custom engine agent UX:

- [Update the app manifest for custom engine agent](#update-the-app-manifest-for-custom-engine-agent).
- [Stream the custom engine agent response to the user](#stream-the-custom-engine-agent-response-to-the-user).
- [Ensure the custom engine agent response contains citations](#ensure-the-custom-engine-agent-response-contains-citations).
- [Ensure the custom engine agent response contains an AI Label](#ensure-the-custom-engine-agent-response-contains-an-ai-label).
- [Ensure that the custom engine agent is an intelligent conversational bot](#ensure-that-the-custom-engine-agent-is-an-intelligent-conversational-bot).
- [Ensure that the custom engine agent offers prompt starters or a welcome card](#ensure-that-the-custom-engine-agent-offers-prompt-starters-or-a-welcome-card).

### Update the app manifest for custom engine agent

You must update the app manifest for the custom engine agent to define specific properties and configurations that characterize its capabilities and behavior.

Here's an example for updating the app manifest. You must add the `botID` property to the `copilotExtensions` node in the app manifest.

<details>
<summary>App manifest update example:</summary>

```json
    "bots": [

        { 
    
          "botId": "bd5b01bf-03ac-4909-99dc-41c6e88451ff", 
    
          // ... existing bot node fields 
    
          "registrationInfo": { 
    
            "source": "microsoftCopilotStudio", 
    
            "environment": "7211551f-2b82-e1af-9013-002025094241", 
    
            "schemaName": "cr4c9_copilot", // New, specific to copilot studio bots 
    
            "clusterCategory": "preprod" // New, specific to copilot studio bots 
    
          } 
    
        } 
    
      ],
    
      "copilotExtensions": {
    
        "customEngineCopilots": [{ // New 
    
          "type": "bot", // Only option 
    
          "id": "bd5b01bf-03ac-4909-99dc-41c6e88451ff"  // Validated against bots node 
    
        }] 
    
      },
    
```

</details>

### Stream the custom engine agent response to the user

A custom engine agent uses LLM to handle complex user requests. This can cause a delay in generating responses. To prevent this delay from being noticeable to users, the agent must stream its responses, making them appear fast despite longer processing time.

Use the following types of updates while streaming responses:

- Informative updates: Send information on the sub-steps as the agent generates the response before it sends the final response.
- Response streaming: Send the intermediate states of the final response while the LLM creates its full response.

You can use one of the following to stream the response:

- Use Teams AI Library to add streaming to the agent.
- Call the Bot Framework APIs directly for streaming.

### Ensure the custom engine agent response contains citations

Users must know the sources a custom engine agent uses to generate its final response. Identifying these resources allows users to validate and trust the agent's responses.

You can use one of the following to include citations for the resources used by the agent:

- Use Teams AI Library citations module.
- Incorporate citations into the Bot Framework API calls.

### Ensure the custom engine agent response contains an AI Label

A custom engine agent must clearly identify that it uses AI. Informing users that a response is AI-generated helps build trust in the agent's capabilities. To ensure this, a custom engine agent must include a flag in each AI-generated response to indicate it was generated by AI. This flag automatically adds an AI label next to the response.

You can use one of the following to include AI Label in the agent's response:

- Use Teams AI Library to add the AI Label to all AI-generated messages automatically.
- Set the flag in the Bot Framework API for message activities.

### Ensure that the custom engine agent is an intelligent conversational bot

A custom engine agent must track a conversation's context and history to provide an intelligent interaction. The agent must meet the user's expectation by being aware of the conversation's context and allowing them to refer to previous messages and responses.

You can use one of the following to ensure intelligent context-based conversation:

- Use Teams AI Library to manage and pass conversational history and context to the LLM.
- Use Bot Framework API to:

  - **Manage context and conversation history**: Ensure that the agent can track the context and conversation history.
  - **Identify conversation location**: Ensure the agent is aware of the platform on which the conversation is ongoing, such as on Teams, copilot.com, in a meeting side-pane, or a group chat.
  - **Store and pass conversation history**: Determine the means of storage and pass some of the conversation history to the agent.
  - **Understand user references**: Ensure that when a user sends a message, the agent must understand what the user is referring to. You can build this understanding in the agent using LLM and the recent conversation history. The agent mustn't need the user to reestablish context with every message.

### Ensure that the custom engine agent offers prompt starters or a welcome card

A custom engine agent must assist users by offering prompt suggestions on how to best utilize the agent. This helps a user overcome challenges not only during their initial use but also in subsequent interactions with the agent.

- **Prompt starters**: Prompts starters are the initial prompts that users see when a custom engine agent is added to a new conversation, such as starting a new one-on-one chat, a new session, or adding it to a group chat. These prompts must be tailored to the user's context and the specific conversation thread.
- **Contextual prompts**: Contextual prompts are dynamic recommendations offered by a custom engine agent during a user interaction. These prompts surface via contextual flyouts, for instance, the **View Prompts** flyout in one-on-one chats and the @mention flyout in group chats and channels. The suggestions are consistently updated to remain pertinent to the ongoing conversation between the user and the agent.
- **Suggested action**: Suggested actions are prompts that users see as pills above the compose box in 1:1 chats and as action buttons in the message footer in group chats. These actions are suggestions that a user may want to take in response to the agent’s message. The prompts are sent along with the agent’s response and must be customized to match the content of the response.

## Best practices for custom engine agent

The following best practices can help enhance the overall effectiveness of a custom engine agent.

- [Ensure that agent's response contains feedback button](#ensure-that-agents-response-contains-feedback-button).
- [Enable Teams Azure AD (AAD) single sign-on (SSO)](#enable-teams-azure-ad-aad-single-sign-on-sso).
- [Enable the custom engine agent to understand conversational history and context](#enable-the-custom-engine-agent-to-understand-conversational-history-and-context).
- [Offer dynamic and contextual suggestion prompts](#offer-dynamic-and-contextual-suggestion-prompts).

### Ensure that agent's response contains feedback button

Develop the capability in the custom engine agent to receive user feedback. This could enable the collection of valuable insights from users, which can be analyzed to identify areas for improvement. By incorporating this feedback, the bot's responses can be continuously refined and enhanced, leading to a more effective and user-friendly interaction experience.

To collect the user feedback, you must:

- Provide feedback buttons with every response.
- Provide the feedback received from the user to the agent.
- Use the feedback to improve the quality of agent's responses.

You can use one of the following to enable feedback collection and usage:

- Use Teams AI Library to add the feedback button property to the AI module. This property adds a feedback button to each AI-generated message automatically.
- Use the feedback flag in the Bot Framework API to add the feedback button for each message.

### Enable Teams Azure AD (AAD) single sign-on (SSO)

You can add single sign-on authentication to your custom engine agent. For more information, see [enable SSO for your app](../authentication/bot-sso-overview.md).

### Enable the custom engine agent to understand conversational history and context

You can design your custom engine agent to understand and refer to conversational history and context. It helps to ensure that every interaction is relevant and tailored to the user's specific needs. The agent can refer to the context and offer responses that are accurate and contextually appropriate. For more information, see [messages in bot conversations](../conversations/conversation-messages.md).

### Offer dynamic and contextual suggestion prompts

Enhance your custom engine agent experience with intelligent and context-aware prompts. The agent can offer context-relevant prompts dynamically. To achieve this, the agent must leverage the conversation context and history, and prompt suggestions can be timely and fit for the query.
