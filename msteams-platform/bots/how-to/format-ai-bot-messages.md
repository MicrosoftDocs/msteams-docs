---
title: Format AI bot messages
description: Learn how to format your bot with an AI label, sensitivity labels, citations, and feedback buttons built using Teams AI library or Bot Framework SDK.
ms.topic: conceptual
ms.localizationpriority: medium
---

# Format AI bot messages

If you're building a conversational bot, you can now leverage features such as citations, feedback buttons, and sensitivity label that enables better user engagement. For AI-powered bots, you can now include AI label to indicate the bot message is AI-powered that can promote a sense of responsibility and implicitly reinforce trust and transparency with users.

Here's a quick overview on each feature that you can integrate to your bot message:

* [AI label](#ai-label) enables user to identify that the message was generated using AI.
* [Citations](#citations) enables user to refer to the source of the bot's message through in-text citations and the reference.
* [Feedback buttons](#feedback-buttons) enables user to provide positive or negative feedback based on their experience.
* [Sensitivity label](#sensitivity-label) enables user to understand the confidentiality of the bot's message.

:::image type="content" source="../../assets/images/bots/ai-bot-message.png" border="false" alt-text="Screenshot shows the AI-generated bot message with the respective AI bot message features.":::

> [!NOTE]
>
> * AI label, sensitivity label, citations, and feedback buttons are available in [public developer preview](../../resources/dev-preview/developer-preview-intro.md) for chats and group chats.
> * Feedback buttons are available only in Teams web and desktop clients for public developer preview.

## AI label

AI label added to your bot message specifies that the message is generated by AI. AI bots use large language models (LLMs) that are generally reliable, however, adding an AI label helps prevent any confusion about the source of the information.

For a bot built using Teams AI library, an AI label is automatically enabled to all AI-powered bot messages that are sent using the `ai` module within the `PredictedSAYCommand` action. For code sample reference, see [Teams AI sample](https://github.com/microsoft/teams-ai/blob/main/js/packages/teams-ai/src/actions/SayCommand.ts).

<!--Here's the code snippet for your reference:
Teams AI library enables AI label in all activities sent through the `ai` module in `PredictedSAYCommand` action.

```javascript
export interface AIEntity {
    type: 'https://schema.org/Message';
    '@type': 'Message';
    '@context': 'https://schema.org';
    additionalType: ['AIGeneratedContent'];
}
```-->

If you're using Bot Framework SDK to build your bot, include `additionalType` under `entities` array of the `message` entity object. Here's the code snippet for your reference:

# [C#](#tab/charp)

```csharp
        await stepContext.Context.SendActivityAsync(
            new Activity
            {
                Type = ActivityTypes.Message,
                Text = ${txt},
               Entities = new List<Entity>
               {
                   new Entity
                   {
                       Type = "https://schema.org/Message",
                       Properties = JObject.FromObject(new Dictionary<string, object>
                       {
                           { "@type", "Message" },
                           { "@context", "https://schema.org" },
                           { "additionalType", new List<string> { "AIGeneratedContent" } }
                       })
                   }
               }
            };
        )
```

# [JavaScript](#tab/js)

```javascript
await context.sendActivity({
         type: ActivityTypes.Message,
         text: `Hey I'm a friendly AI bot. This message is generated through AI [1]`, // cite with [1],
        entities: [
          {
            type: "https://schema.org/Message",
            "@type": "Message",
            "@context": "https://schema.org",
            additionalType: ["AIGeneratedContent"], // AI Generated label
          }
        ]
       });
```

---

<!--The code snippets are Bot Framework SDK samples.

To add an AI label manually to your bot message, include `additionalType` under `entities` array of the `message` entity object. The following code snippet shows how to add an AI label to your bot's message:

```json
{
    "type": ActivityTypes.Message,
    "text": // ...
    // ... other properties
    "entities": [
        {
            "type": "https://schema.org/Message",
            "@type": "Message",
            "@context": "https://schema.org",
            /**
              * Indicate that the content was generated by AI.
              */
            "additionalType": ["AIGeneratedContent"]
        }
    ]
}
```

To learn more about how to add the flag manually and modify `PredictedSAYCommand`, see [Modify PredictedSAYCommand](#modify-predictedsaycommand).-->

After an AI label is added, your bot’s message displays an **AI-generated** label next to the bot’s name with a hover-over disclaimer stating, **AI-generated content may be incorrect**. The AI label and disclaimer can't be customized for AI-powered bots.

:::image type="content" source="../../assets/images/bots/ai-bot-label.png" border="false" alt-text="Screenshot shows an AI bot label.":::

## Citations

It's important to cite the sources of the bot message that helps users to ask follow-up questions or conduct independent research. Citing the data sources such as files, messages, emails, and work items enables users to get valuable insights. Citations are important for bots using techniques like RAG.

Citations to your bot message include in-text citations, details to citation reference, and sensitivity labels for the content referenced.

* **In-text citations** denote the citation numbers added to the bot message in the [X] format, each corresponding to a reference. A citation can be inserted anywhere within the text.
* **Details to citation reference** include the title, keywords, an abstract, hyperlink, and sensitivity information. References appear as pop-ups for each in-text citation.
* **Sensitivity labels to citations** indicate the confidentiality of the citation content referenced and aren't added automatically. To add sensitivity labels for citations, see [modify PredictedSAYCommand](#modify-predictedsaycommand).

*Citation limit call out placeholder*

### Add citations

For bots built using Teams AI library, citations are added to an AI bot message automatically through `PredictedSAYCommand` action. You can also modify the `PredictedSAYCommand` action to add citations to your bot message. Here's a code snippet for your reference:

<!--```javascript
export interface ClientCitation {
    '@type': 'Claim';
    position: string;
    appearance: {
        '@type': 'DigitalDocument';
        name: string;
        text?: string;
        url?: string;
        abstract: string;
        keywords?: string[];
        usageInfo?: SensitivityUsageInfo;
    };
}

```-->

```javascript
export function sayCommand<TState extends TurnState = TurnState>(feedbackLoopEnabled: boolean = false) {
    return async (context: TurnContext, _state: TState, data: PredictedSayCommand) => {
        if (!data.response?.content) {
            return '';
        }

        let content = data.response.content;
        const isTeamsChannel = context.activity.channelId === Channels.Msteams;

        if (isTeamsChannel) {
            content = content.split('\n').join('<br>');
        }

        // If the response from AI includes citations, those citations will be parsed and added to the SAY command.
        let citations: ClientCitation[] | undefined = undefined;

        if (data.response.context && data.response.context.citations.length > 0) {
            citations = data.response.context!.citations.map((citation, i) => {
                return {
                    '@type': 'Claim',
                    position: `${i + 1}`,
                    appearance: {
                        '@type': 'DigitalDocument',
                        name: citation.title,
                        abstract: Utilities.snippet(citation.content, 500)
                    }
                } as ClientCitation;
            });
        }

        // If there are citations, modify the content so that the sources are numbers instead of [doc1], [doc2], etc.
        const contentText = !citations ? content : Utilities.formatCitationsResponse(content);

        // If there are citations, filter out the citations unused in content.
        const referencedCitations = citations ? Utilities.getUsedCitations(contentText, citations) : undefined;

        await context.sendActivity({
            type: ActivityTypes.Message,
            text: contentText,
            ...(isTeamsChannel ? { channelData: { feedbackLoopEnabled } } : {}),
            entities: [
                {
                    type: 'https://schema.org/Message',
                    '@type': 'Message',
                    '@context': 'https://schema.org',
                    additionalType: ['AIGeneratedContent'],
                    ...(referencedCitations ? { citation: referencedCitations } : {})
                }
            ] as AIEntity[]
        });

        return '';
    };
}
```

For code sample reference, see [Teams AI sample](https://github.com/microsoft/teams-ai/blob/main/js/packages/teams-ai/src/actions/SayCommand.ts).

If you're using Bot Framework SDK to build your bot, include `citation` under `entities` array. Here's the code snippet for your reference:

```javascript
 await context.sendActivity({
         type: ActivityTypes.Message,
         text: `Hey I'm a friendly AI bot. This message is generated through AI [1]`, // cite with [1],
        entities: [
          {
            type: "https://schema.org/Message",
            "@type": "Message",
            "@context": "https://schema.org",
            citation: [
              {
                "@type": "Claim",
                position: 1, // Required. Should match the [1] in the text above
                appearance: {
                  "@type": "DigitalDocument",
                  name: "AI bot", // Title
                  url: "https://example.com/claim-1", // Hyperlink on the title
                  usageInfo: {
                    "@type": "CreativeWork",
                    name: "Confidential \\ Contoso FTE", // Sensitivity title
                    description: "Only accessible to Contoso FTE", // Sensitivity description
                  },
                },
              },
            ],
          },
        ],
}
```

<!-- ### Add citation reference

Citation references are an indexed list that corresponds to in-text citations. This list provides key details such as the title of the citation, the link to the source, and a relevant quote from the source.

To add a citation reference list to your bot message, include `citation` array in the `entities` object, as shown in the following code snippet:

```json
{
    "type": "message",
    "from": {
        "id": "28:48b2e1fd-b6b8-46ce-8074-8e918304fcb2"
    },
    "conversation": {
        "isGroup": true,
        "id": "19:136c757a-88d8-48c1-829d-3007c9f684b0@thread.tacv2"
    },
    "recipient": {
        "id": "8:orgid:7e425333-960e-4d3e-b136-0e98701ff5cc"
    },
    "textFormat": "plain",
    "text": "c53a7514-4abb-4592-b882-c2d0fac6f5bb[1];",
    "attachments": [],
    "entities": [
        {
            "@type": "Message",
            "@context": "https://schema.org",
            "@id": "",
            "citation": [
                { 
                    "@type": "Claim",
                    "position": 1,
                    "appearance": {
                        "@type": "DigitalDocument",
                        "name": "Name 1",
                        "url": "https://example.com/claim-1",
                        "abstract": "Abstract 1",
                        "keywords": [
                            "Keyword1 - 1",
                            "Keyword1 - 2",
                            "Keyword1 - 3"
                        ],
                        "usageInfo": {
                            "@type": "CreativeWork",
                            "description": "UsageInfo 1 description",
                            "name": "UsageInfo 1"
                        }
                    }
                }
            ]
        }
    ]
}
```

You can manually add sensitivity labels to citations to indicate the confidentiality of the content referenced. To enable sensitivity labels for citations, modify the message to include `usageInfo` in the `entities` object.

The following code snippet shows the sensitivity labels in citations of your bot's message:

```json
{ 
    "type": "message", 
    "from": { 
        "id": "28:48b2e1fd-b6b8-46ce-8074-8e918304fcb2" 
    }, 
    "conversation": { 
        "isGroup": true, 
        "id": "19:5a5faeb2-8967-4469-b306-9a319072f96f@thread.tacv2" 
    }, 
    "recipient": { 
        "id": "8:orgid:209f94ff-7f34-42a2-883e-5dafc6a7d2f8" 
    }, 
    "textFormat": "plain", 
    "text": "1721a2f9-c79e-4502-b62e-ae31189ba17e[1];", 
    "attachments": [], 
    "entities": [ 
        { 
            "@type": "Message", 
            "@context": "https://schema.org", 
            "@id": "", 
            "citation": [ 
                { 
                    "@type": "Claim", 
                    "position": 1, 
                    "appearance": { 
                        "@type": "DigitalDocument", 
                        "name": "Name 1", 
                        "usageInfo": { 
                            "@type": "CreativeWork", 
                            "@id": "usage-info-1", 
                            "description": "UsageInfo 1 description", 
                            "name": "UsageInfo 1" 
                        } 
                    } 
                } 
            ], 
            "usageInfo": { 
                "@type": "CreativeWork", 
                "@id": "usage-info-1" 
            } 
        } 
    ] 
}
```-->

After you enable citations, the bot's message includes the in-text citations and the reference. The in-text citations display the reference details when users hover over the citation.

:::image type="content" source="../../assets/images/bots/ai-bot-inline-citation.png" border="false" alt-text="Screenshot shows an AI bot response with in-text citation.":::

### Error handling

| Error code | Description |
| --- | --- |
| 400 | Multiple root message entities found in the bot activity. |
| 400 | Error parsing message entity from activity object. |
| 400 | Bot message with more than 10 citations. |
| 400 | Claim added has empty appearance. |
| 400 | Error while parsing citation entity with ID: X. |

## Feedback buttons

Feedback buttons in bot messages are crucial for measuring user engagement, identifying errors, and gaining insights into your bot's performance in real-world scenarios. This can lead to targeted and effective enhancements of your bot’s conversational capabilities. You must enable feedback buttons for the users to like or dislike messages and also provide detailed feedback.

:::image type="content" source="../../assets/images/bots/bot-feedback-buttons.png" border="false" alt-text="Screenshot shows the feedback buttons in a bot.":::

When the user selects a feedback button, a respective feedback form appears based on the user's selection.

:::image type="content" source="../../assets/images/bots/bot-feedback-form.png" border="false" alt-text="Screenshot shows the feedback form in a bot.":::

### Enable feedback buttons

To enable feedback buttons in your bot, add a `channelData` object in your bot's message and set `feedbackLoopEnabled` to true.

The following code snippet shows how to enable feedback buttons in a bot:

```json
{
    "type": "message",
    "from": {
        "id": "28:48b2e1fd-b6b8-46ce-8074-8e918304fcb2"
    },
    "conversation": {
        "isGroup": true,
        "id": "19:21e795db-9804-4bb8-9a6a-f85b9e8e9602@thread.tacv2"
    },
    "recipient": {
        "id": "8:orgid:67cc58d0-4a80-496a-a019-437b70bc6529"
    },
    "text": "93001cd5-45f4-4a9a-b694-0f44eecfd004",
    "attachments": [],
    "entities": [],
    "channelData": {
        "feedbackLoopEnabled": true
    }
}
```

For a bot built using Teams AI library, Teams enables feedback buttons to all bot messages when `enable_feedback_loop` is set to `true` in the `ai` module.

```javascript
export const app = new Application<ApplicationTurnState>({
    ai: {
        planner: planner,
        enable_feedback_loop: true
    },
```

[Sample code reference](https://github.com/microsoft/teams-ai/blob/main/js/samples/04.ai-apps/h.datasource-azureOpenAI/src/app.ts)

After you enable feedback buttons, all SAY commands from the bot have `feedbackLoopEnabled` automatically set to `true` in the `channelData` object.

```javascript
await context.sendActivity({
  type: ActivityTypes.Message,
  text: `Hey I'm a friendly AI bot. This message is generated through AI [1]`, // cite with [1],
  channelData: {
    feedbackLoopEnabled: true // Enable feedback buttons
  },
});
```

Feedback buttons are located at the footer of the bot’s message, and include a 👍 (thumbs up) and a 👎 (thumbs down) button for the user to choose from. You can collect feedback on bot responses from personal chats, group chats, and channels.

The bot receives the user's input, received in the feedback form, through a bot invoke flow. The following code snippet shows a bot invoke containing positive feedback from a user:

```json
{
 "name": "message/submitAction",
 "conversation": {
  "id": "19:144de878089f94d7db699d10a4672bc040@thread.v2"
 },
 "value": {
  "actionName": "feedback",
  "actionValue": {
    "reaction": "like",
    "feedback": "test feedback"
  }
 }
}

```

The following code snippet shows a bot invoke containing feedback from a user for a bot built using Teams AI library:

```javascript
{
    "actionName: "feedback",
    "actionValue": {
        "reaction": string, //"like" or "dislike"
        "feedback": string
    },
    "replyToId": string
}

```

### Handle feedback

You need to have an `onInvokeActivity` handler to correctly process the invoke when the bot receives it. Ensure that you return a status code 200 with an empty JSON object as a response.

Teams automatically notifies the user that their feedback was submitted successfully. Therefore, don't send a message or notification to the user upon receiving feedback.

The following code snippet shows how to handle feedback received in a bot invoke and return a response with the status code 200:

```javascript
public async onInvokeActivity(context: TurnContext): Promise<InvokeResponse> {
    try {
      switch (context.activity.name) {
        case "message/submitAction":
           console.log('Your feedback is ' + JSON.stringify(context.activity.value))
           // {"actionName":"feedback","actionValue":{"reaction":"like","feedback":"{\"feedbackText\":\"user written feedback\"}"}}
           return CreateInvokeResponse(200, {});
        default:
          return {
            status: 200,
            body: `Unknown invoke activity handled as default- ${context.activity.name}`,
          };
      }
    } catch (err) {
      console.log(`Error in onInvokeActivity: ${err}`);
      return {
        status: 500,
        body: `Invoke activity received- ${context.activity.name}`,
      };
    }
  }

 export const CreateInvokeResponse = (
  status: number,
  body?: unknown
 ): InvokeResponse => {
    return { status, body };
 };
```

If your bot is built using Teams AI library, the bot invoke received is automatically handled. To handle feedback, use the `app.feedbackLoop` method to register a feedback loop handler that is called when the user provides feedback.

```javascript
app.feedbackLoop(async (context, state, feedbackLoopData) => {
  // custom logic here...
});
```

It’s important to store feedback after you receive it. Hence, ensure that you store the message IDs and the content of the messages that your bot sends and receives. When your bot receives an invoke containing feedback, match the message ID of the bot’s message with the corresponding feedback.

> [!NOTE]
> Teams neither stores or processes feedback, nor does it provide an API or a storage mechanism.

If a user uninstalls your bot and still has access to the bot chat, Teams removes the feedback buttons from the bot's messages to prevent the user from providing feedback to the bot.

### Error handling

| Error code | Description |
| --- | --- |
| 400 | When the `submit/messageAction` invoke response isn't empty. |

## Sensitivity label

Bot responses might contain information that's confidential or only accessible to certain individuals within the organization. You must add a sensitivity label to help users identify the confidentiality of a message, enabling them to exercise caution when sharing the message.

> [!NOTE]
> Add this label to your bot's messages only if it contains sensitive information.

For bots built using Teams AI library, sensitivity labels can be added through `PredictedSAYCommand` action. For code sample reference, see [Teams AI sample](https://github.com/microsoft/teams-ai/blob/main/js/packages/teams-ai/src/actions/SayCommand.ts#L107).

<!--Here's the code snippet for your reference:

```javascript
export interface SensitivityUsageInfo {
    type: 'https://schema.org/Message';
    '@type': 'CreativeWork';
    description?: string; // Sensitivity description of the content
    name: string; // Sensitivity title of the content
}
```-->

If you're using Bot Framework SDK to build your bot, add sensitivity label to your bot message by modifying the message to include `usageInfo` in the `entities` object.

The code snippet shows how to add sensitivity labels in both bot message and citation and also to add AI label, citation, and feedback buttons:

```javascript
await context.sendActivity({
  type: ActivityTypes.Message,
  text: `Hey, I'm a friendly AI bot. This message is generated through AI [1]`,
  channelData: {
    feedbackLoopEnabled: true,
  },
  entities: [
    {
      type: "https://schema.org/Message",
      "@type": "Message",
      "@context": "https://schema.org",
      usageInfo: {
        "@type": "CreativeWork",
        "@id": "sensitivity1"
      },
      additionalType: ["AIGeneratedContent"],
      citation: [
        {
          "@type": "Claim",
          position: 1,
          appearance: {
            "@type": "DigitalDocument",
            name: "AI bot",
            url: "https://example.com/claim-1",
            usageInfo: {
              "@type": "CreativeWork",
              "@id": "sensitivity1",
              name: "Sensitivity title",
              description: "Sensitivity description",
            },
          },
        },
      ],
    },
  ],
});

```

<!-->```javascript
await context.sendActivity({
         type: ActivityTypes.Message,
         text: `Hey I'm a friendly AI bot. This message is generated through AI [1]`, // cite with [1],
        entities: [
          {
            type: "https://schema.org/Message",
            "@type": "Message",
            "@context": "https://schema.org",
            usageInfo: {
              "@type": "CreativeWork",
              description: "Please be mindful of sharing outside of your team", // Sensitivity description
              name: "Confidential \\ Contoso FTE", // Sensitivity title
            },
          },
        ],

```-->

After the sensitivity label is added, your bot message contains a shield icon. Users can hover over the icon to find a disclaimer message on the sensitivity of the message.

:::image type="content" source="../../assets/images/bots/ai-bot-sensitivity-label.png" border="false" alt-text="Screenshot shows an AI bot sensitivity label.":::

### Error handling

| Error code | Description |
| --- | --- |
| 400 | Multiple root message entities found in the bot activity. |
| 400 | Error parsing message entity from activity object. |
| 400 | No usage info to link for a message level usage info. |
| 400 | Multiple usage info to link for a message level usage info. |

## Modify PredictedSAYCommand

For a bot built using Teams AI library, the `PredictedSAYCommand` provides more control on how AI label, sensitivity label, citations, and feedback buttons are added to the bot's activity. To modify `PredictedSAYCommand`, use the following code:

```JavaScript
app.ai.action<PredictedSayCommand>(AI.SayCommandActionName, async (context, state, data, action) => {
  // custom logic here...
  await context.sendActivity(data.content);
  return "";
});
```

## Query parameters

| Value | Required | Description |
|:--|:--|:--|
| `additionalType` |  |  |
| `feedbackLoopEnabled` |  |  |
| `citation` |  |  |
| `citation.position` |  |  |
| `citation.@type` |  |  |
| `citation.appearance.@type` |  |  |
| `citation.appearance.name` |  |  |
| `citation.appearance.usageInfo.@type` |  |  |
| `citation.appearance.usageInfo.name` |  |  |
| `citation.appearance.usageInfo.description` |  |  |
| `usageInfo.@type` |  |  |
| `usageInfo.@id` |  |  |

## Code samples

| S.No. | Description | .NET | Node.js | Manifest |
|:--|:--|--|---|---|
| 1 | This sample app provides a bot with an AI label, feedback buttons, sensitivity label, and citations in messages. | [View](https://github.com/OfficeDev/Microsoft-Teams-Samples) | [View](https://github.com/OfficeDev/Microsoft-Teams-Samples) | [View](https://github.com/OfficeDev/Microsoft-Teams-Samples) |

## See also

* [Bot activity handlers](../bot-basics.md)
* [Format your bot messages](format-your-bot-messages.md)
* [Update and delete messages sent from bot](update-and-delete-bot-messages.md)
* [Get started with Teams AI library](Teams%20conversational%20AI/how-conversation-ai-get-started.md)
