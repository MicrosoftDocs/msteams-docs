{"version":3,"sources":["utils/factories.ts"],"names":["mergeStyles","cx","React","ReactIs","mappedProps","iframe","img","input","createShorthandFactory","Component","mappedProp","mappedArrayProp","allowsJSX","isValidElementType","Error","value","options","createShorthandInternal","valIsNoop","render","valIsPrimitive","valIsPropsObject","valIsArray","valIsReactElement","isValidElement","process","env","NODE_ENV","displayName","console","error","join","defaultProps","usersProps","overrideProps","props","mappedHTMLProps","as","className","mergedClassesNames","split","style","styles","generateKey","key","elementKey","isNullKey","kind","children","undefined","createElement","createShorthand","shorthandConfig","fluentComposeConfig"],"mappings":"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","sourcesContent":["import { mergeStyles } from '@fluentui/styles';\nimport { ComponentWithAs, ComposePreparedOptions, ShorthandConfig } from '@fluentui/react-bindings';\nimport cx from 'classnames';\nimport * as _ from 'lodash';\nimport * as React from 'react';\nimport * as ReactIs from 'react-is';\n\nimport { ShorthandValue, Props, PropsOf, ShorthandRenderFunction } from '../types';\n\ntype HTMLTag = 'iframe' | 'img' | 'input';\ntype ShorthandProp = 'children' | 'src' | 'type';\n\ninterface CreateShorthandOptions<P> {\n  /** Default props object */\n  defaultProps?: () => Partial<Props<P>>;\n\n  /** Override props object or function (called with regular props) */\n  overrideProps?: Partial<Props<P>> | ((props: P) => Partial<Props<P>>);\n\n  /** Whether or not automatic key generation is allowed */\n  generateKey?: boolean;\n\n  /** Override the default render implementation. */\n  render?: ShorthandRenderFunction<P>;\n}\n\n// It's only necessary to map props that don't use 'children' as value ('children' is the default)\nconst mappedProps: { [key in HTMLTag]: ShorthandProp } = {\n  iframe: 'src',\n  img: 'src',\n  input: 'type',\n};\n\nexport type ShorthandFactory<P> = (\n  value: ShorthandValue<P>,\n  options?: CreateShorthandOptions<P>,\n) => React.ReactElement | null | undefined;\n\n// ============================================================\n// Factory Creators\n// ============================================================\n\n/**\n * @param config - Options passed to factory\n * @returns A shorthand factory function waiting for `val` and `defaultProps`.\n */\nexport function createShorthandFactory<TStringElement extends keyof JSX.IntrinsicElements, P>(config: {\n  /** A ReactClass or string */\n  Component: TStringElement;\n  /** A function that maps a primitive value to the Component props */\n  mappedProp?: keyof PropsOf<TStringElement>;\n  /** A function that maps an array value to the Component props */\n  mappedArrayProp?: keyof PropsOf<TStringElement>;\n  /** Indicates if factory supports React Elements */\n  allowsJSX?: boolean;\n}): ShorthandFactory<P>;\nexport function createShorthandFactory<TFunctionComponent extends React.FunctionComponent, P>(config: {\n  Component: TFunctionComponent;\n  mappedProp?: keyof PropsOf<TFunctionComponent>;\n  mappedArrayProp?: keyof PropsOf<TFunctionComponent>;\n  allowsJSX?: boolean;\n}): ShorthandFactory<P>;\nexport function createShorthandFactory<TInstance extends React.Component, P>(config: {\n  Component: { new (...args: any[]): TInstance };\n  mappedProp?: keyof PropsOf<TInstance>;\n  mappedArrayProp?: keyof PropsOf<TInstance>;\n  allowsJSX?: boolean;\n}): ShorthandFactory<P>;\nexport function createShorthandFactory<P>({ Component, mappedProp, mappedArrayProp, allowsJSX }) {\n  if (!ReactIs.isValidElementType(Component)) {\n    throw new Error('createShorthandFactory() Component must be a string or function.');\n  }\n\n  return (value, options: CreateShorthandOptions<P>) =>\n    createShorthandInternal({\n      allowsJSX,\n      Component,\n      mappedProp,\n      mappedArrayProp,\n      value,\n      options,\n    });\n}\n\n// ============================================================\n// Factories\n// ============================================================\n\nexport function createShorthandInternal<P>({\n  Component,\n  mappedProp,\n  mappedArrayProp,\n  value,\n  options = {},\n  allowsJSX = true,\n}: {\n  Component: React.ElementType<P>;\n  mappedProp?: string;\n  mappedArrayProp?: string;\n  allowsJSX?: boolean;\n  value?: ShorthandValue<P>;\n  options?: CreateShorthandOptions<P>;\n}) {\n  if (!ReactIs.isValidElementType(Component)) {\n    throw new Error('createShorthand() Component must be a string or function.');\n  }\n\n  // short circuit noop values\n  const valIsNoop = _.isNil(value) || typeof value === 'boolean';\n  if (valIsNoop && !options.render) return null;\n\n  const valIsPrimitive = typeof value === 'string' || typeof value === 'number';\n  const valIsPropsObject = _.isPlainObject(value);\n  const valIsArray = _.isArray(value);\n  const valIsReactElement = React.isValidElement(value);\n\n  // unhandled type warning\n  if (process.env.NODE_ENV !== 'production') {\n    const displayName = typeof Component === 'string' ? Component : Component.displayName;\n\n    if (!valIsPrimitive && !valIsPropsObject && !valIsArray && !valIsReactElement && !valIsNoop) {\n      /* eslint-disable-next-line no-console */\n      console.error(\n        [\n          `The shorthand prop for \"${displayName}\" component was passed a JSX element but this slot only supports string|number|object|array|ReactElements.`,\n          ' Use null|undefined|boolean for none.',\n          ` Received: ${value}`,\n        ].join(''),\n      );\n    }\n\n    if (!allowsJSX && valIsReactElement) {\n      /* eslint-disable-next-line no-console */\n      console.error(\n        [\n          `The shorthand prop for \"${displayName}\" component was passed a JSX element but this slot only supports string|number|object|array.`,\n          ' Use null|undefined|boolean for none.',\n          ` Received: ${value}`,\n        ].join(''),\n      );\n    }\n  }\n\n  // ----------------------------------------\n  // Build up props\n  // ----------------------------------------\n  const defaultProps = options.defaultProps ? options.defaultProps() || ({} as Props<P>) : ({} as Props<P>);\n\n  // User's props\n  const usersProps =\n    (valIsReactElement && ({} as Props<P>)) || (valIsPropsObject && (value as Props<P>)) || ({} as Props<P>);\n\n  // Override props\n  const overrideProps: Props<P> =\n    typeof options.overrideProps === 'function'\n      ? (options.overrideProps({ ...defaultProps, ...usersProps }) as Props<P>)\n      : (options.overrideProps as Props<P>) || ({} as Props<P>);\n\n  // Merge props\n  const props: Props<P> = { ...defaultProps, ...usersProps, ...overrideProps };\n\n  const mappedHTMLProps = mappedProps[overrideProps.as || defaultProps.as];\n\n  // Map prop for primitive value\n  if (valIsPrimitive || valIsReactElement) {\n    (props as any)[mappedHTMLProps || mappedProp || 'children'] = value;\n  }\n\n  // Map prop for array value\n  if (valIsArray) {\n    (props as any)[mappedHTMLProps || mappedArrayProp || 'children'] = value;\n  }\n\n  // Merge className\n  if (defaultProps.className || overrideProps.className || usersProps.className) {\n    const mergedClassesNames = cx(defaultProps.className, overrideProps.className, usersProps.className);\n    (props as any).className = _.uniq(mergedClassesNames.split(' ')).join(' ');\n  }\n\n  // Merge style\n  if (defaultProps.style || overrideProps.style || usersProps.style) {\n    (props as any).style = { ...defaultProps.style, ...usersProps.style, ...overrideProps.style };\n  }\n\n  // Merge styles\n  if (defaultProps.styles || overrideProps.styles || usersProps.styles) {\n    (props as any).styles = mergeStyles(defaultProps.styles, usersProps.styles, overrideProps.styles);\n  }\n\n  // ----------------------------------------\n  // Get key\n  // ----------------------------------------\n  const { generateKey = true } = options;\n\n  // Use key or generate key\n  if (generateKey && _.isNil(props.key)) {\n    if (valIsPrimitive) {\n      // use string/number shorthand values as the key\n      (props as any).key = value;\n    }\n\n    if (valIsReactElement) {\n      // use the key from React Element\n      const elementKey = (value as React.ReactElement).key;\n      // <div /> - key is not passed as will be `null`\n      // <div key={null} /> - key is passed as `null` and will be stringified\n      const isNullKey = elementKey === null;\n\n      if (!isNullKey) {\n        (props as any).key = elementKey;\n      }\n    }\n  }\n\n  // Remove the kind prop from the props object\n  delete props.kind;\n\n  // ----------------------------------------\n  // Create Element\n  // ----------------------------------------\n  const { render } = options;\n  if (render) {\n    return render(Component, props);\n  }\n\n  if (typeof props.children === 'function') {\n    return props.children(Component, { ...props, children: undefined });\n  }\n\n  if (!allowsJSX && valIsReactElement) {\n    return null;\n  }\n\n  // Create ReactElements from built up props\n  if (valIsPrimitive || valIsPropsObject || valIsArray || valIsReactElement) {\n    return React.createElement(Component, props);\n  }\n\n  return null;\n}\n\nexport function createShorthand<TFunctionComponent extends React.FunctionComponent>(\n  Component: TFunctionComponent & {\n    shorthandConfig?: ShorthandConfig<PropsOf<TFunctionComponent>>;\n    fluentComposeConfig?: ComposePreparedOptions<PropsOf<TFunctionComponent>>;\n  },\n  value?: ShorthandValue<PropsOf<TFunctionComponent>>,\n  options?: CreateShorthandOptions<PropsOf<TFunctionComponent>>,\n): React.ReactElement;\nexport function createShorthand<TInstance extends React.Component>(\n  Component: { new (...args: any[]): TInstance } & {\n    shorthandConfig?: ShorthandConfig<PropsOf<TInstance>>;\n    fluentComposeConfig?: ComposePreparedOptions<PropsOf<TInstance>>;\n  },\n  value?: ShorthandValue<PropsOf<TInstance>>,\n  options?: CreateShorthandOptions<PropsOf<TInstance>>,\n): React.ReactElement;\nexport function createShorthand<E extends keyof JSX.IntrinsicElements, P>(\n  Component: ComponentWithAs<E, P> & {\n    shorthandConfig?: ShorthandConfig<P>;\n    fluentComposeConfig?: ComposePreparedOptions<P>;\n  },\n  value?: ShorthandValue<P>,\n  options?: CreateShorthandOptions<P>,\n): React.ReactElement;\nexport function createShorthand<TElementType extends React.ElementType>(\n  Component: TElementType & {\n    shorthandConfig?: ShorthandConfig<PropsOf<TElementType>>;\n    fluentComposeConfig?: ComposePreparedOptions<PropsOf<TElementType>>;\n  },\n  value?: ShorthandValue<PropsOf<TElementType>>,\n  options?: CreateShorthandOptions<PropsOf<TElementType>>,\n): React.ReactElement;\nexport function createShorthand<P>(Component, value?, options?) {\n  const { mappedProp = 'children', allowsJSX = true, mappedArrayProp } =\n    Component.shorthandConfig || Component.fluentComposeConfig?.shorthandConfig || {};\n\n  return createShorthandInternal<P>({\n    Component,\n    mappedProp,\n    allowsJSX,\n    mappedArrayProp,\n    value,\n    options: options || {},\n  });\n}\n"],"file":"factories.js"}